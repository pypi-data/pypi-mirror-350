"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[4113],{562:(e,a,t)=>{t.d(a,{A:()=>d});var n=t(85861),r=t(46920),i=t(40563),s=t(96540),l=t(78518),o=t(2445);const d=function({show:e,onHide:a,title:t,onSave:d,children:u,initialValues:c={},formSubmitHandler:g,bodyStyle:m={},requiredFields:h=[]}){const[p]=i.lV.useForm(),[P,E]=(0,s.useState)(!1),b=(0,s.useCallback)((()=>{p.resetFields(),E(!1)}),[p]),[_,y]=(0,s.useState)(!0),f=(0,s.useCallback)((()=>{b(),a()}),[a,b]),v=(0,s.useCallback)((()=>{b(),d()}),[d,b]),w=(0,s.useCallback)((async e=>{try{E(!0),await g(e),v()}catch(e){console.error(e)}finally{E(!1)}}),[g,v]),S=()=>{const e=p.getFieldsError().some((({errors:e})=>e.length)),a=p.getFieldsValue(),t=h.some((e=>!a[e]));y(e||t)};return(0,o.Y)(n.Ay,{show:e,title:t,onHide:f,bodyStyle:m,footer:(0,o.FD)(o.FK,{children:[(0,o.Y)(r.A,{buttonStyle:"secondary","data-test":"modal-cancel-button",onClick:f,children:(0,l.t)("Cancel")}),(0,o.Y)(r.A,{buttonStyle:"primary",htmlType:"submit",onClick:()=>p.submit(),"data-test":"form-modal-save-button",disabled:P||_,children:P?(0,l.t)("Saving..."):(0,l.t)("Save")})]}),children:(0,o.Y)(i.lV,{form:p,layout:"vertical",onFinish:w,initialValues:c,onValuesChange:S,onFieldsChange:S,children:"function"==typeof u?u(p):u})})}},8960:(e,a,t)=>{var n=t(30327);a.createFirstEllipsis=function(e){return{type:n.ITEM_TYPES.ELLIPSIS,key:n.ITEM_KEYS.FIRST_ELLIPSIS,value:e,isActive:!1}},a.createSecondEllipsis=function(e){return{type:n.ITEM_TYPES.ELLIPSIS,key:n.ITEM_KEYS.SECOND_ELLIPSIS,value:e,isActive:!1}},a.createFirstPageLink=function(e){var a=e.currentPage;return{type:n.ITEM_TYPES.FIRST_PAGE_LINK,key:n.ITEM_KEYS.FIRST_PAGE_LINK,value:1,isActive:1===a}},a.createPreviousPageLink=function(e){var a=e.currentPage;return{type:n.ITEM_TYPES.PREVIOUS_PAGE_LINK,key:n.ITEM_KEYS.PREVIOUS_PAGE_LINK,value:Math.max(1,a-1),isActive:1===a}},a.createNextPageLink=function(e){var a=e.currentPage,t=e.totalPages;return{type:n.ITEM_TYPES.NEXT_PAGE_LINK,key:n.ITEM_KEYS.NEXT_PAGE_LINK,value:Math.min(t,a+1),isActive:a===t}},a.createLastPageLink=function(e){var a=e.currentPage,t=e.totalPages;return{type:n.ITEM_TYPES.LAST_PAGE_LINK,key:n.ITEM_KEYS.LAST_PAGE_LINK,value:t,isActive:a===t}},a.createPageFunctionFactory=function(e){var a=e.currentPage;return function(e){return{type:n.ITEM_TYPES.PAGE,key:e,value:e,isActive:e===a}}}},11447:(e,a,t)=>{var n=t(17991),r=t(8960);a.getPaginationModel=function(e){if(null==e)throw new Error("getPaginationModel(): options object should be a passed");var a=Number(e.totalPages);if(isNaN(a))throw new Error("getPaginationModel(): totalPages should be a number");if(a<0)throw new Error("getPaginationModel(): totalPages shouldn't be a negative number");var t=Number(e.currentPage);if(isNaN(t))throw new Error("getPaginationModel(): currentPage should be a number");if(t<0)throw new Error("getPaginationModel(): currentPage shouldn't be a negative number");if(t>a)throw new Error("getPaginationModel(): currentPage shouldn't be greater than totalPages");var i=null==e.boundaryPagesRange?1:Number(e.boundaryPagesRange);if(isNaN(i))throw new Error("getPaginationModel(): boundaryPagesRange should be a number");if(i<0)throw new Error("getPaginationModel(): boundaryPagesRange shouldn't be a negative number");var s=null==e.siblingPagesRange?1:Number(e.siblingPagesRange);if(isNaN(s))throw new Error("getPaginationModel(): siblingPagesRange should be a number");if(s<0)throw new Error("getPaginationModel(): siblingPagesRange shouldn't be a negative number");var l=Boolean(e.hidePreviousAndNextPageLinks),o=Boolean(e.hideFirstAndLastPageLinks),d=Boolean(e.hideEllipsis),u=d?0:1,c=[],g=r.createPageFunctionFactory(e);if(o||c.push(r.createFirstPageLink(e)),l||c.push(r.createPreviousPageLink(e)),1+2*u+2*s+2*i>=a){var m=n.createRange(1,a).map(g);c.push.apply(c,m)}else{var h=i,p=n.createRange(1,h).map(g),P=a+1-i,E=a,b=n.createRange(P,E).map(g),_=Math.min(Math.max(t-s,h+u+1),P-u-2*s-1),y=_+2*s,f=n.createRange(_,y).map(g);if(c.push.apply(c,p),!d){var v=_-1,w=(v===h+1?g:r.createFirstEllipsis)(v);c.push(w)}if(c.push.apply(c,f),!d){var S=y+1,I=(S===P-1?g:r.createSecondEllipsis)(S);c.push(I)}c.push.apply(c,b)}return l||c.push(r.createNextPageLink(e)),o||c.push(r.createLastPageLink(e)),c};var i=t(30327);a.ITEM_TYPES=i.ITEM_TYPES,a.ITEM_KEYS=i.ITEM_KEYS},17991:(e,a)=>{a.createRange=function(e,a){for(var t=[],n=e;n<=a;n++)t.push(n);return t}},18575:(e,a,t)=>{a.w$=a.uv=void 0;var n=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},r=l(t(96540)),i=l(t(5556)),s=t(11447);function l(e){return e&&e.__esModule?e:{default:e}}a.uv=function(e){var a=e.itemTypeToComponent,t=e.WrapperComponent,l=void 0===t?"div":t,o=function(e){var t=e.currentPage,i=e.totalPages,o=e.boundaryPagesRange,d=e.siblingPagesRange,u=e.hideEllipsis,c=e.hidePreviousAndNextPageLinks,g=e.hideFirstAndLastPageLinks,m=e.onChange,h=e.disabled,p=function(e,a){var t={};for(var n in e)a.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}(e,["currentPage","totalPages","boundaryPagesRange","siblingPagesRange","hideEllipsis","hidePreviousAndNextPageLinks","hideFirstAndLastPageLinks","onChange","disabled"]),P=(0,s.getPaginationModel)({currentPage:t,totalPages:i,boundaryPagesRange:o,siblingPagesRange:d,hideEllipsis:u,hidePreviousAndNextPageLinks:c,hideFirstAndLastPageLinks:g}),E=function(e,a,t){return function(i){var s,l,o,d=e[i.type],u=(l=(s=i).value,o=s.isDisabled,function(){!o&&t&&a!==l&&t(l)});return r.default.createElement(d,n({onClick:u},i))}}(a,t,m);return r.default.createElement(l,p,P.map((function(e){return E(n({},e,{isDisabled:!!h}))})))};return o.propTypes={currentPage:i.default.number.isRequired,totalPages:i.default.number.isRequired,boundaryPagesRange:i.default.number,siblingPagesRange:i.default.number,hideEllipsis:i.default.bool,hidePreviousAndNextPageLinks:i.default.bool,hideFirstAndLastPageLinks:i.default.bool,onChange:i.default.func,disabled:i.default.bool},o},a.w$=s.ITEM_TYPES},30327:(e,a)=>{a.ITEM_TYPES={PAGE:"PAGE",ELLIPSIS:"ELLIPSIS",FIRST_PAGE_LINK:"FIRST_PAGE_LINK",PREVIOUS_PAGE_LINK:"PREVIOUS_PAGE_LINK",NEXT_PAGE_LINK:"NEXT_PAGE_LINK",LAST_PAGE_LINK:"LAST_PAGE_LINK"},a.ITEM_KEYS={FIRST_ELLIPSIS:-1,SECOND_ELLIPSIS:-2,FIRST_PAGE_LINK:-3,PREVIOUS_PAGE_LINK:-4,NEXT_PAGE_LINK:-5,LAST_PAGE_LINK:-6}},50068:(e,a,t)=>{t.d(a,{Dj:()=>l.Dj,cp:()=>l.cp,Ay:()=>s});var n=t(96453),r=t(2445);const i=n.I4.span`
  &,
  & svg {
    vertical-align: top;
  }
`;function s({checked:e=!1,onChange:a,style:t,className:n}){return(0,r.Y)(i,{style:t,onClick:()=>{a(!e)},role:"checkbox",tabIndex:0,"aria-checked":e,"aria-label":"Checkbox",className:n||"",children:e?(0,r.Y)(l.Dj,{}):(0,r.Y)(l.cp,{})})}var l=t(75264)},73856:(e,a,t)=>{t.r(a),t.d(a,{default:()=>T});var n=t(96540),r=t(96453),i=t(78518),s=t(35742),l=t(17437),o=t(50500),d=t(51713),u=t(83691),c=t(43849),g=t(37020),m=t(63358),h=t(65256),p=t(67073),P=t(5261),E=t(562),b=t(40563),_=t(90868),y=t(50068),f=t(28990);const v=async e=>s.A.delete({endpoint:`/api/v1/security/users/${e}`});var w=t(2445);function S({show:e,onHide:a,onSave:t,roles:n,isEditMode:r=!1,user:l}){const{addDangerToast:o,addSuccessToast:d}=(0,P.Yf)(),u=r?["first_name","last_name","username","email","roles"]:["first_name","last_name","username","email","password","roles","confirmPassword"],c={...l,roles:(null==l?void 0:l.roles.map((e=>e.id)))||[]};return(0,w.Y)(E.A,{show:e,onHide:a,title:r?(0,i.t)("Edit User"):(0,i.t)("Add User"),onSave:t,formSubmitHandler:async e=>{const a=async(e,a)=>{let t="create"===a?(0,i.t)("Error while adding user!"):(0,i.t)("Error while updating user!");if(422===e.status){const a=await e.json(),n=(null==a?void 0:a.message)||"";n.includes("duplicate key value")&&(n.includes("ab_user_username_key")?t=(0,i.t)("This username is already taken. Please choose another one."):n.includes("ab_user_email_key")&&(t=(0,i.t)("This email is already associated with an account.")))}throw o(t),e};if(r){if(!l)throw new Error("User is required in edit mode");try{await(async(e,a)=>{await s.A.put({endpoint:`/api/v1/security/users/${e}`,jsonPayload:{...a}})})(l.id,e),d((0,i.t)("User was successfully updated!"))}catch(e){await a(e,"update")}}else try{await(async e=>{const{confirmPassword:a,...t}=e;null==t.active&&(t.active=!1),await s.A.post({endpoint:"/api/v1/security/users/",jsonPayload:{...t}})})(e),d((0,i.t)("User was successfully created!"))}catch(e){await a(e,"create")}},requiredFields:u,initialValues:c,children:e=>(0,w.FD)(w.FK,{children:[(0,w.Y)(b.eI,{name:"first_name",label:(0,i.t)("First name"),rules:[{required:!0,message:(0,i.t)("First name is required")}],children:(0,w.Y)(_.pd,{name:"first_name",placeholder:(0,i.t)("Enter the user's first name")})}),(0,w.Y)(b.eI,{name:"last_name",label:(0,i.t)("Last name"),rules:[{required:!0,message:(0,i.t)("Last name is required")}],children:(0,w.Y)(_.pd,{name:"last_name",placeholder:(0,i.t)("Enter the user's last name")})}),(0,w.Y)(b.eI,{name:"username",label:(0,i.t)("Username"),rules:[{required:!0,message:(0,i.t)("Username is required")}],children:(0,w.Y)(_.pd,{name:"username",placeholder:(0,i.t)("Enter the user's username")})}),(0,w.Y)(b.eI,{name:"active",label:(0,i.t)("Is active?"),valuePropName:"checked",children:(0,w.Y)(y.Ay,{onChange:a=>{e.setFieldsValue({isActive:a})}})}),(0,w.Y)(b.eI,{name:"email",label:(0,i.t)("Email"),rules:[{required:!0,message:(0,i.t)("Email is required")},{type:"email",message:(0,i.t)("Please enter a valid email address")}],children:(0,w.Y)(_.pd,{name:"email",placeholder:(0,i.t)("Enter the user's email")})}),(0,w.Y)(b.eI,{name:"roles",label:(0,i.t)("Roles"),rules:[{required:!0,message:(0,i.t)("Role is required")}],children:(0,w.Y)(f.A,{name:"roles",mode:"multiple",placeholder:(0,i.t)("Select roles"),options:n.map((e=>({value:e.id,label:e.name}))),getPopupContainer:e=>e.closest(".antd5-modal-content")})}),!r&&(0,w.FD)(w.FK,{children:[(0,w.Y)(b.eI,{name:"password",label:(0,i.t)("Password"),rules:[{required:!0,message:(0,i.t)("Password is required")}],children:(0,w.Y)(_.pd.Password,{name:"password",placeholder:"Enter the user's password"})}),(0,w.Y)(b.eI,{name:"confirmPassword",label:(0,i.t)("Confirm Password"),dependencies:["password"],rules:[{required:!0,message:(0,i.t)("Please confirm your password")},({getFieldValue:e})=>({validator:(a,t)=>t&&e("password")!==t?Promise.reject(new Error((0,i.t)("Passwords do not match!"))):Promise.resolve()})],children:(0,w.Y)(_.pd.Password,{name:"confirmPassword",placeholder:(0,i.t)("Confirm the user's password")})})]})]})})}const I=e=>(0,w.Y)(S,{...e,isEditMode:!1}),A=e=>(0,w.Y)(S,{...e,isEditMode:!0});var L;!function(e){e.ADD="add",e.EDIT="edit"}(L||(L={}));const k=[{label:"Yes",value:!0},{label:"No",value:!1}],T=function({user:e}){const a=(0,r.DP)(),{addDangerToast:t,addSuccessToast:E}=(0,P.Yf)(),{state:{loading:b,resourceCount:_,resourceCollection:y,bulkSelectEnabled:f},fetchData:S,refreshData:T,toggleBulkSelect:Y}=(0,o.RU)("security/users",(0,i.t)("User"),t),[C,N]=(0,n.useState)({edit:!1,add:!1,duplicate:!1}),F=e=>N((a=>({...a,[e]:!0}))),M=e=>N((a=>({...a,[e]:!1}))),[D,R]=(0,n.useState)(null),[K,H]=(0,n.useState)(null),[x,G]=(0,n.useState)(!0),[U,q]=(0,n.useState)([]),O=(0,n.useMemo)((()=>{if(!y||0===y.length)return{min:0,max:0};const e=y.map((e=>e.login_count));return{min:Math.min(...e),max:Math.max(...e)}}),[y]),V=(0,n.useMemo)((()=>{if(!y||0===y.length)return{min:0,max:0};const e=y.map((e=>e.fail_login_count));return{min:Math.min(...e),max:Math.max(...e)}}),[y]),j=(0,n.useMemo)((()=>(0,h.N6)(e)),[e]),B=(0,n.useCallback)((async()=>{try{const e=100,a=async a=>(await s.A.get({endpoint:`api/v1/security/roles/?q=(page_size:${e},page:${a})`})).json,t=await a(0),n=t.count,r=t.result;if(e>=n)return void q(r);const i=Math.ceil(n/e),l=Array.from({length:i-1},((e,t)=>a(t+1))),o=await Promise.all(l);q([...r,...o.flatMap((e=>e.result))])}catch(e){t((0,i.t)("Error while fetching roles"))}finally{G(!1)}}),[]);(0,n.useEffect)((()=>{B()}),[B]);const $=[{id:"username",desc:!0}],z=(0,n.useMemo)((()=>[{accessor:"first_name",Header:(0,i.t)("First name"),Cell:({row:{original:{first_name:e}}})=>(0,w.Y)("span",{children:e})},{accessor:"last_name",Header:(0,i.t)("Last name"),Cell:({row:{original:{last_name:e}}})=>(0,w.Y)("span",{children:e})},{accessor:"username",Header:(0,i.t)("Username"),Cell:({row:{original:{username:e}}})=>(0,w.Y)("span",{children:e})},{accessor:"email",Header:(0,i.t)("Email"),Cell:({row:{original:{email:e}}})=>(0,w.Y)("span",{children:e})},{accessor:"active",Header:(0,i.t)("Is active?"),Cell:({row:{original:{active:e}}})=>(0,w.Y)("span",{children:e?"Yes":"No"})},{accessor:"roles",Header:(0,i.t)("Roles"),Cell:({row:{original:{roles:e}}})=>(0,w.Y)("span",{children:e.map((e=>e.name)).join(", ")}),disableSortBy:!0},{accessor:"login_count",Header:(0,i.t)("Login count"),hidden:!0,Cell:({row:{original:e}})=>e.login_count},{accessor:"fail_login_count",Header:(0,i.t)("Fail login count"),hidden:!0,Cell:({row:{original:e}})=>e.fail_login_count},{accessor:"created_on",Header:(0,i.t)("Created on"),hidden:!0,Cell:({row:{original:{created_on:e}}})=>e},{accessor:"changed_on",Header:(0,i.t)("Changed on"),hidden:!0,Cell:({row:{original:{changed_on:e}}})=>e},{accessor:"last_login",Header:(0,i.t)("Last login"),hidden:!0,Cell:({row:{original:{last_login:e}}})=>e},{Cell:({row:{original:e}})=>{const a=j?[{label:"user-list-edit-action",tooltip:(0,i.t)("Edit user"),placement:"bottom",icon:"EditOutlined",onClick:()=>{R(e),F(L.EDIT)}},{label:"role-list-delete-action",tooltip:(0,i.t)("Delete user"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>H(e)}]:[];return(0,w.Y)(u.A,{actions:a})},Header:(0,i.t)("Actions"),id:"actions",disableSortBy:!0,hidden:!j,size:"xl"}]),[j]),X=[];j&&X.push({name:(0,w.FD)(w.FK,{children:[(0,w.Y)(p.F.PlusOutlined,{iconColor:a.colors.primary.light5,iconSize:"m",css:l.AH`
                margin: auto ${2*a.gridUnit}px auto 0;
                vertical-align: text-top;
              `}),(0,i.t)("User")]}),buttonStyle:"primary",onClick:()=>{F(L.ADD)},loading:x,"data-test":"add-user-button"},{name:(0,i.t)("Bulk select"),onClick:Y,buttonStyle:"secondary"});const W=(0,n.useMemo)((()=>[{Header:(0,i.t)("First name"),key:"first_name",id:"first_name",input:"search",operator:c.t.Contains},{Header:(0,i.t)("Last name"),key:"last_name",id:"last_name",input:"search",operator:c.t.Contains},{Header:(0,i.t)("Username"),key:"username",id:"username",input:"search",operator:c.t.Contains},{Header:(0,i.t)("Email"),key:"email",id:"email",input:"search",operator:c.t.Contains},{Header:(0,i.t)("Is active?"),key:"active",id:"active",input:"select",operator:c.t.Equals,unfilteredLabel:(0,i.t)("All"),selects:null==k?void 0:k.map((e=>({label:e.label,value:e.value}))),loading:x},{Header:(0,i.t)("Roles"),key:"roles",id:"roles",input:"select",operator:c.t.RelationManyMany,unfilteredLabel:(0,i.t)("All"),selects:null==U?void 0:U.map((e=>({label:e.name,value:e.id}))),loading:x},{Header:(0,i.t)("Created on"),key:"created_on",id:"created_on",input:"datetime_range",operator:c.t.Between,dateFilterValueType:"iso"},{Header:(0,i.t)("Changed on"),key:"changed_on",id:"changed_on",input:"datetime_range",operator:c.t.Between,dateFilterValueType:"iso"},{Header:(0,i.t)("Last login"),key:"last_login",id:"last_login",input:"datetime_range",operator:c.t.Between,dateFilterValueType:"iso"},{Header:(0,i.t)("Login count"),key:"login_count",id:"login_count",input:"numerical_range",operator:c.t.Between,min:O.min,max:O.max},{Header:(0,i.t)("Fail login count"),key:"fail_login_count",id:"fail_login_count",input:"numerical_range",operator:c.t.Between}]),[x,U,O,V]),J={title:(0,i.t)("No users yet"),image:"filter-results.svg",...j&&{buttonAction:()=>{F(L.ADD)},buttonText:(0,w.FD)(w.FK,{children:[(0,w.Y)(p.F.PlusOutlined,{iconColor:a.colors.primary.light5,iconSize:"m",css:l.AH`
              margin: auto ${2*a.gridUnit}px auto 0;
              vertical-align: text-top;
            `}),(0,i.t)("User")]})}};return(0,w.FD)(w.FK,{children:[(0,w.Y)(d.A,{name:(0,i.t)("List Users"),buttons:X}),(0,w.Y)(I,{onHide:()=>M(L.ADD),show:C.add,onSave:()=>{T(),M(L.ADD)},roles:U}),C.edit&&D&&(0,w.Y)(A,{user:D,show:C.edit,onHide:()=>M(L.EDIT),onSave:()=>{T(),M(L.EDIT)},roles:U}),K&&(0,w.Y)(g.A,{description:(0,i.t)("This action will permanently delete the user."),onConfirm:()=>{K&&(async({id:e,username:a})=>{try{await v(e),T(),H(null),E((0,i.t)("Deleted user: %s",a))}catch(e){t((0,i.t)("There was an issue deleting %s",a))}})(K)},onHide:()=>H(null),open:!0,title:(0,i.t)("Delete User?")}),(0,w.Y)(m.A,{title:(0,i.t)("Please confirm"),description:(0,i.t)("Are you sure you want to delete the selected users?"),onConfirm:e=>{const a=[];Promise.all(e.map((e=>v(e.id).then((()=>{a.push(e.username)})).catch((a=>{t((0,i.t)("Error deleting %s",e.username))}))))).then((()=>{a.length>0&&E((0,i.t)("Deleted users: %s",a.join(", ")))})).finally((()=>{T()}))},children:e=>{const a=j?[{key:"delete",name:(0,i.t)("Delete"),onSelect:e,type:"danger"}]:[];return(0,w.Y)(c.A,{className:"user-list-view",columns:z,count:_,data:y,fetchData:S,filters:W,initialSort:$,loading:b,pageSize:25,bulkActions:a,bulkSelectEnabled:f,disableBulkSelect:Y,addDangerToast:t,addSuccessToast:E,emptyState:J,refreshData:T})}})]})}},83691:(e,a,t)=>{t.d(a,{A:()=>d});var n=t(96453),r=t(19129),i=t(67073),s=t(2445);const l=n.I4.span`
  white-space: nowrap;
  min-width: 100px;
  svg,
  i {
    margin-right: 8px;

    &:hover {
      path {
        fill: ${({theme:e})=>e.colors.primary.base};
      }
    }
  }
`,o=n.I4.span`
  color: ${({theme:e})=>e.colors.grayscale.base};
`;function d({actions:e}){return(0,s.Y)(l,{className:"actions",children:e.map(((e,a)=>{const t=i.F[e.icon];return e.tooltip?(0,s.Y)(r.m_,{id:`${e.label}-tooltip`,title:e.tooltip,placement:e.placement,children:(0,s.Y)(o,{role:"button",tabIndex:0,className:"action-button","data-test":e.label,onClick:e.onClick,children:(0,s.Y)(t,{iconSize:"l"})})},a):(0,s.Y)(o,{role:"button",tabIndex:0,className:"action-button",onClick:e.onClick,"data-test":e.label,children:(0,s.Y)(t,{})},a)}))})}}}]);