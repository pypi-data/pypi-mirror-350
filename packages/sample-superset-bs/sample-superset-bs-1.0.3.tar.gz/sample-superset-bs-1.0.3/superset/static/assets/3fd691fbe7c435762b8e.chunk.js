"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5721],{13686:(e,t,n)=>{n.d(t,{t:()=>f});var r=n(77189);const a=String.raw`\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.\d+)?(?:(?:[+-]\d\d:\d\d)|Z)?`,i=String.raw`(?:TODAY|NOW)`,s=String.raw`[+-]?[1-9][0-9]*`,l=String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`,o=RegExp(String.raw`^DATEADD\(DATETIME\("(${a}|${i})"\),\s(${s}),\s(${l})\)$`,"i"),c=RegExp(String.raw`^${a}$|^${i}$`,"i"),u=["now","today"],d=new Date;d.setHours(0,0,0,0);const m=new Date;m.setHours(0,0,0,0);const g={sinceDatetime:d.setDate(d.getDate()-7).toString(),sinceMode:"relative",sinceGrain:"day",sinceGrainValue:-7,untilDatetime:m.toString(),untilMode:"specific",untilGrain:"day",untilGrainValue:7,anchorMode:"now",anchorValue:"now"},f=e=>{const t=e.split(r.wv);if(2===t.length){const[e,n]=t;if(c.test(e)&&c.test(n)){const t=u.includes(e)?e:"specific",r=u.includes(n)?n:"specific";return{customRange:{...g,sinceDatetime:e,untilDatetime:n,sinceMode:t,untilMode:r},matchedFlag:!0}}const r=e.match(o);if(r&&c.test(n)&&e.includes(n)){const[e,t,a]=r.slice(1),i=u.includes(n)?n:"specific";return{customRange:{...g,sinceGrain:a,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilDatetime:e,sinceMode:"relative",untilMode:i},matchedFlag:!0}}const a=n.match(o);if(c.test(e)&&a&&n.includes(e)){const[t,n,r]=[...a.slice(1)],i=u.includes(e)?e:"specific";return{customRange:{...g,untilGrain:r,untilGrainValue:parseInt(n,10),sinceDatetime:t,untilDatetime:t,untilMode:"relative",sinceMode:i},matchedFlag:!0}}if(r&&a){const[e,t,n]=[...r.slice(1)],[i,s,l]=[...a.slice(1)];if(e===i)return{customRange:{...g,sinceGrain:n,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilGrain:l,untilGrainValue:parseInt(s,10),untilDatetime:i,anchorValue:e,sinceMode:"relative",untilMode:"relative",anchorMode:"now"===e?"now":"specific"},matchedFlag:!0}}}return{customRange:g,matchedFlag:!1}}},49277:(e,t,n)=>{n.d(t,{M9:()=>c,TX:()=>u,cy:()=>o});var r=n(62193),a=n.n(r),i=n(62952),s=n(13686);const l=864e5,o=(e,t=!1,n=!1)=>{const r=new Date;if("now"===e||"No filter"===e||""===e)return r;if("today"===e)return r.setHours(0,0,0,0),r;if(n?r.setHours(-r.getTimezoneOffset()/60,0,0,0):r.setHours(0,0,0,0),t&&null!=e&&e.includes("Last"))return r;switch(e){case"Last day":return r.setUTCDate(r.getUTCDate()-1),r;case"Last week":return r.setUTCDate(r.getUTCDate()-7),r;case"Last month":return r.setUTCMonth(r.getUTCMonth()-1),r;case"Last quarter":return r.setUTCMonth(r.getUTCMonth()-3),r;case"Last year":return r.setUTCFullYear(r.getUTCFullYear()-1),r;case"previous calendar week":return t?r.setDate(r.getDate()-r.getDay()+1):r.setDate(r.getDate()-r.getDay()-6),r;case"previous calendar month":return t?r.setDate(1):(r.setDate(1),r.setMonth(r.getMonth()-1)),r;case"previous calendar year":return t?r.setFullYear(r.getFullYear(),0,1):r.setFullYear(r.getFullYear()-1,0,1),r}if(null!=e&&e.includes("ago")){const t=e.split(" "),n=parseInt(t[0],10);switch(t[1]){case"day":case"days":r.setUTCDate(r.getUTCDate()-n);break;case"week":case"weeks":r.setUTCDate(r.getUTCDate()-7*n);break;case"month":case"months":r.setUTCMonth(r.getUTCMonth()-n);break;case"year":case"years":r.setUTCFullYear(r.getUTCFullYear()-n)}return r}const i=null==e?void 0:e.split("-");let s=null;return s=i&&!a()(i)?1===i.length?new Date(Date.UTC(parseInt(i[0],10),0)):2===i.length?new Date(Date.UTC(parseInt(i[0],10),parseInt(i[1],10)-1)):3===i.length?new Date(parseInt(i[0],10),parseInt(i[1],10)-1,parseInt(i[2],10)):new Date(e):new Date(e),s&&!Number.isNaN(s.getTime())?(n?s.setHours(-s.getTimezoneOffset()/60,0,0,0):s.setHours(0,0,0,0),s):null},c=(e,t,n)=>{let r;if(r="now"===e||"today"===e?new Date:new Date(e),!Number.isNaN(r.getTime())){switch(t){case"second":r.setSeconds(r.getSeconds()+n);break;case"minute":r.setMinutes(r.getMinutes()+n);break;case"hour":r.setHours(r.getHours()+n);break;case"day":r.setDate(r.getDate()+n);break;case"week":r.setDate(r.getDate()+7*n);break;case"month":r.setMonth(r.getMonth()+n);break;case"quarter":r.setMonth(r.getMonth()+3*n);break;case"year":r.setFullYear(r.getFullYear()+n)}return r}return null},u=({timeRangeFilter:e,shifts:t,startDate:n,includeFutureOffsets:r=!0})=>{var a,u,d,m,g,f;const{customRange:h,matchedFlag:p}=(0,s.t)(null!=(a=null==e?void 0:e.comparator)?a:"");let v=null,D=null;if(p){var y,b;const{sinceDatetime:e,sinceMode:t,sinceGrain:n,sinceGrainValue:r,untilDatetime:a,untilMode:i,untilGrain:s,untilGrainValue:l}={...h};v="relative"!==t?"specific"===t?new Date(e):o(e,!1,!0):c(e,n,r),null==(y=v)||y.setHours(0,0,0,0),D="relative"!==i?"specific"===i?new Date(a):o(a,!1,!0):c(a,s,l),null==(b=D)||b.setHours(0,0,0,0)}const w=null==t?void 0:t.includes("custom"),T=null==t?void 0:t.includes("inherit");let $;var C;w&&($=p?new Date(new Date(n).setUTCHours(new Date(n).getTimezoneOffset()/60,0,0,0)).getTime():null==(C=o(n))?void 0:C.getTime());const[x,M]=(null!=(u=null==e?void 0:e.comparator)?u:"").split(" : ").map((e=>e.trim())),U=(null==(d=null!=(m=v)?m:o(x,!1,!1))?void 0:d.getTime())||0,F=(null==(g=null!=(f=D)?f:o(M||x,!0,!1))?void 0:g.getTime())||0,R=$&&U&&Math.round((U-$)/l),S=T&&F&&U&&Math.round((F-U)/l),k=(0,i.A)(t).map((e=>{if("custom"===e&&void 0!==R&&!Number.isNaN(R)){if(r&&R<0)return-1*R+" days after";if(R>=0&&U)return`${R} days ago`}if("inherit"===e&&S&&!Number.isNaN(S)){if(r&&S<0)return-1*S+" days after";if(S>0)return`${S} days ago`}return e})).filter((e=>"custom"!==e&&"inherit"!==e));return(0,i.A)(k)}},55721:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var r=n(62193),a=n.n(r),i=n(96540),s=n(96453),l=n(77189),o=n(49277),c=n(62952),u=n(17437),d=n(78518),m=n(42370),g=n(97689),f=n(45186),h=n(38221),p=n.n(h);const v=e=>{const t=(0,i.useRef)(null),n=(0,i.useRef)(null),[r,a]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{let r;const i=t.current,s=n.current;if(i&&s){const t=Array.from(i.children);r=new ResizeObserver(p()((()=>{t.reduce(((e,t)=>{var n,r;return e+(null!=(n=null==(r=t.firstElementChild)?void 0:r.scrollWidth)?n:0)}),0)+e*Math.max(t.length-1,0)>s.clientWidth?a(!0):a(!1)}),500)),r.observe(document.body),t.forEach((e=>{r.observe(e)}))}return()=>{var e;return null==(e=r)?void 0:e.disconnect()}}),[e]),{isOverflowing:r,symbolContainerRef:t,wrapperRef:n}};var D=n(2445);const y=s.I4.div`
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  width: 100%;
  overflow: auto;
`,b=s.I4.div`
  ${({theme:e,subheaderFontSize:t})=>`\n    font-weight: ${e.typography.weights.light};\n    display: flex;\n    justify-content: center;\n    font-size: ${t||20}px;\n    flex: 1 1 0px;\n  `}
`,w=s.I4.span`
  ${({theme:e,backgroundColor:t,textColor:n})=>`\n    background-color: ${t};\n    color: ${n};\n    padding: ${e.gridUnit}px ${2*e.gridUnit}px;\n    border-radius: ${2*e.gridUnit}px;\n    margin-right: ${e.gridUnit}px;\n  `}
`;function T(e){const{height:t,width:n,bigNumber:r,prevNumber:h,valueDifference:p,percentDifferenceFormattedString:T,headerFontSize:$,subheaderFontSize:C,comparisonColorEnabled:x,comparisonColorScheme:M,percentDifferenceNumber:U,currentTimeRangeFilter:F,startDateOffset:R,shift:S,subtitle:k,subtitleFontSize:A,dashboardTimeRange:N}=e,[H,I]=(0,i.useState)("");(0,i.useEffect)((()=>{if(F&&(S||R)){if(!a()(S)||R){const e=(0,l.x9)(null!=N?N:F.comparator,F.subject);Promise.resolve(e).then((e=>{var t;const n=null==e||null==(t=e.value)?void 0:t.match(m.Io),[r,a]=null!=n?n:[],i=(0,o.TX)({timeRangeFilter:{...F,comparator:`${r} : ${a}`},shifts:(0,c.A)(S),startDate:R||""});(0,l.x9)(null!=N?N:F.comparator,F.subject,(0,c.A)(i)).then((e=>{const t=(0,c.A)(e.value).flat()[0].split("vs\n");I(t.length>1?t[1].trim():t[0])}))}))}}else I("")}),[F,S,R,N]);const Y=(0,s.DP)(),G=5*Y.gridUnit,E=u.AH`
    font-family: ${Y.typography.families.sansSerif};
    display: flex;
    justify-content: center;
    align-items: center;
    height: ${t}px;
    width: ${n}px;
    overflow: auto;
  `,O=u.AH`
    font-size: ${$||60}px;
    font-weight: ${Y.typography.weights.normal};
    text-align: center;
    margin-bottom: ${4*Y.gridUnit}px;
  `,z=s.I4.div`
    ${({theme:e})=>`\n    font-family: ${e.typography.families.sansSerif};\n    font-weight: ${e.typography.weights.medium};\n    text-align: center;\n    margin-top: -10px;\n    margin-bottom: ${4*e.gridUnit}px;\n  `}
  `,V=u.AH`
    color: ${x&&0!==U?U>0?M===f.m.Green?Y.colors.success.base:Y.colors.error.base:M===f.m.Red?Y.colors.success.base:Y.colors.error.base:Y.colors.grayscale.base};
    margin-left: ${Y.gridUnit}px;
  `,j=Y.colors.grayscale.light4,K=Y.colors.grayscale.base,{backgroundColor:L,textColor:P}=(0,i.useMemo)((()=>{let e=j,t=K;if(x&&0!==U){const n=U>0&&M===f.m.Green||U<0&&M===f.m.Red;e=n?Y.colors.success.light2:Y.colors.error.light2,t=n?Y.colors.success.base:Y.colors.error.base}return{backgroundColor:e,textColor:t}}),[Y,M,x,U]),q=(0,i.useMemo)((()=>[{defaultSymbol:"#",value:h,tooltipText:(0,d.t)("Data for %s",H||"previous range"),columnKey:"Previous value"},{defaultSymbol:"△",value:p,tooltipText:(0,d.t)("Value difference between the time periods"),columnKey:"Delta"},{defaultSymbol:"%",value:T,tooltipText:(0,d.t)("Percentage difference between the time periods"),columnKey:"Percent change"}].map((t=>{var n;const r=null==(n=e.columnConfig)?void 0:n[t.columnKey];return{...t,symbol:!1===(null==r?void 0:r.displayTypeIcon)?"":t.defaultSymbol,label:(null==r?void 0:r.customColumnName)||t.columnKey}}))),[H,h,p,T,e.columnConfig]).filter((t=>{var n,r;return!1!==(null==(n=e.columnConfig)||null==(r=n[t.columnKey])?void 0:r.visible)})),{isOverflowing:W,symbolContainerRef:_,wrapperRef:X}=v(G);return(0,D.Y)("div",{css:E,ref:X,children:(0,D.FD)(y,{css:W&&u.AH`
            width: fit-content;
            margin: auto;
            align-items: flex-start;
          `,children:[(0,D.FD)("div",{css:O,children:[r,0!==U&&(0,D.Y)("span",{css:V,children:U>0?"↑":"↓"})]}),k&&(0,D.Y)(z,{style:{fontSize:A*t*.4+"px"},children:k}),q.length>0&&(0,D.Y)("div",{css:[u.AH`
                display: flex;
                justify-content: space-around;
                gap: ${G}px;
                min-width: 0;
                flex-shrink: 1;
              `,W?u.AH`
                    flex-direction: column;
                    align-items: flex-start;
                    width: fit-content;
                  `:u.AH`
                    align-items: center;
                    width: 100%;
                  `,"",""],ref:_,children:q.map(((t,n)=>{var r,a;return(0,D.Y)(b,{subheaderFontSize:C,children:(0,D.FD)(g.m,{id:"tooltip",placement:"top",title:t.tooltipText,children:[t.symbol&&(0,D.Y)(w,{backgroundColor:n>0?L:j,textColor:n>0?P:K,children:t.symbol}),t.value," ",(null==(r=e.columnConfig)||null==(a=r[t.columnKey])?void 0:a.customColumnName)||""]})},`comparison-symbol-${t.columnKey}`)}))})]})})}},77189:(e,t,n)=>{n.d(t,{wv:()=>u,x9:()=>f});var r=n(62193),a=n.n(r),i=n(58561),s=n.n(i),l=n(62952),o=n(35742),c=n(51436);const u=" : ",d=(e,t)=>`${e}${u}${t}`,m=(e,t)=>e.replace("T00:00:00","")||(t?"-∞":"∞"),g=(e,t="col")=>{const n=e.split(u);return 1===n.length?e:`${m(n[0],!0)} ≤ ${t} < ${m(n[1])}`},f=async(e,t="col",n)=>{let r,i;if(a()(n))r=s().encode_uri(e),i=`/api/v1/time_range/?q=${r}`;else{const t=(0,l.A)(n).map((t=>({timeRange:e,shift:t})));r=s().encode_uri([{timeRange:e},...t]),i=`/api/v1/time_range/?q=${r}`}try{var f;const e=await o.A.get({endpoint:i});if(a()(n)){var h,p,v,D;const n=d((null==e||null==(h=e.json)||null==(p=h.result[0])?void 0:p.since)||"",(null==e||null==(v=e.json)||null==(D=v.result[0])?void 0:D.until)||"");return{value:g(n,t)}}const r=null==e||null==(f=e.json)?void 0:f.result.map((e=>d(e.since,e.until)));return{value:r.slice(1).map((e=>((e,t,n="col")=>{const r=e.split(u),a=t.split(u);return`${n}: ${m(r[0],!0)} to ${m(r[1])} vs\n  ${m(a[0],!0)} to ${m(a[1])}`})(r[0],e,t)))}}catch(e){const t=await(0,c.h4)(e);return{error:t.message||t.error||e.statusText}}}}}]);