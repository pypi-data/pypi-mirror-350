"use strict";(self.webpackChunkjupyterlab_unianalytics_telemetry=self.webpackChunkjupyterlab_unianalytics_telemetry||[]).push([[208],{208:(e,t,o)=>{o.r(t),o.d(t,{PERSISTENT_USER_ID:()=>R,default:()=>z,disabledNotebooksSignaler:()=>V,isDashboardExtensionInstalled:()=>F,schemaIcon:()=>P});const n="jupyterlab_unianalytics_telemetry",s="SendExtension",i="unianalytics";var l,a;!function(e){e.notebookId=`${i}_notebook_id`,e.cellMapping=`${i}_cell_mapping`}(l||(l={})),function(e){e.dashboardOpenChat=`${n}:unianalytics-open-chat`,e.pushCellUpdate=`${n}:group-push-cell-update`}(a||(a={}));var c=o(609),d=o(449),r=o(901);class h{static setJupyterVersion(e){h._jupyterVersion=e}static checkJupyterVersionSet(){if(null===h._jupyterVersion)throw new Error("JupyterLab version is not set in CompatibilityManager before trying to access it.")}}h._jupyterVersion=null,h.getMetadataComp=(e,t)=>{var o;return h.checkJupyterVersionSet(),4===h._jupyterVersion?null==e?void 0:e.getMetadata(t):null===(o=null==e?void 0:e.metadata)||void 0===o?void 0:o.get(t)},h.setMetadataComp=(e,t,o)=>{var n;h.checkJupyterVersionSet(),4===h._jupyterVersion?null==e||e.setMetadata(t,o):null===(n=null==e?void 0:e.metadata)||void 0===n||n.set(t,o)},h.getCellIdsComp=e=>(h.checkJupyterVersionSet(),Array.from({length:e.length},((t,o)=>e.get(o).id)));const p=e=>{let t=0;if("string"==typeof e)t=e.length;else if(Array.isArray(e))for(const o of e)t+=o.length;else for(const o in e)t+=JSON.stringify(e[o]).length;return t},u=e=>{if(!e||e.isDisposed)return[];const t=h.getMetadataComp(e.context.model,l.cellMapping);return t?t.map((e=>e[1])):[]};var _=o(490),g=o(943),m=o(156);class C{constructor(){this._messageCallback=null,this._socket=null}_createSocket(e,t){this._socket=(0,m.io)(`${j}?conType=STUDENT&nbId=${e}&userId=${t}`,{transports:["websocket"]}),this._socket.on("connect",(()=>{console.log(`${n}: SocketIO connection opened for:`,{notebookId:e,userId:t})})),this._socket.on("disconnect",(o=>{console.log(`${n}: SocketIO connection closed (reason: ${o}) for:`,{notebookId:e,userId:t})})),this._socket.on("chat",(e=>{this._messageCallback&&this._messageCallback(e,"teacher")})),this._socket.on("group_chat",(e=>{this._messageCallback&&this._messageCallback(e,"teammate")})),this._socket.on("connect_error",(e=>{console.error(`${n}: SocketIO error; `,e)}))}establishSocketConnection(e,t){this.closeSocketConnection(),this._messageCallback=t,e&&R&&this._createSocket(e,R)}closeSocketConnection(){this._socket&&this._socket.close(),this._socket=null}sendMessageToTeammates(e,t){this._socket&&this._socket.emit("group_message",{userId:e,message:t})}}const b="update_cell",k="update_notebook";function f(e,t,o,n){let s="Notebook Updated",i=`Your ${n} updated this notebook. Would you like to get the latest version?`;if(o===b)s="Cell Updated",i=`Your ${n} updated a cell in this notebook. Would you like to get the latest version?`;else{if(o!==k)return void console.error("Unknown action type:",o);s="Notebook Updated",i=`Your ${n} updated the entire notebook. Would you like to get the latest version?`}const l=Math.random().toString(36).substring(2,15),a=`\n      <div id="update-notification-${l}" class="notification">\n        <p style="font-weight: bold;">${s}</p>\n        <p>${i}</p>\n        <p>(Note: your code will be kept in its original cell.)</p>\n        <div class="notification-button-container">\n          <button id="update-${l}-button" class="notification-accept-button">Update Now</button>\n          <button id="close-${l}-button" class="notification-close-button">Close</button>\n        </div>\n      </div>\n    `;document.body.insertAdjacentHTML("beforeend",a);const c=document.getElementById(`update-notification-${l}`),d=document.getElementById(`update-${l}-button`),r=document.getElementById(`close-${l}-button`);d&&d.addEventListener("click",(async()=>{await async function(e,t){var o;try{const n="string"==typeof t?JSON.parse(t).cells:t.cells,s=u(e),i=e.content,l=(new Date).toLocaleString();for(const e of n){const t=s.lastIndexOf(e.id),n=e.cell_type||"code";let a="";if(a="markdown"===n?`CELL RECEIVED AT ${l}\n\n${e.source}`:`# CELL RECEIVED AT ${l}\n\n${e.source}`,-1===t){e.source=a,null===(o=i.model)||void 0===o||o.sharedModel.addCell(e);continue}i.activeCellIndex=t,_.NotebookActions.insertBelow(i),"markdown"===n&&_.NotebookActions.changeCellType(i,"markdown");const c=t+1;i.widgets[c].model.sharedModel.setSource(a),i.activeCellIndex=c,i.mode="command",i.scrollToItem(c,"center")}}catch(e){console.error("Failed to update notebook content:",e)}}(e,t),c&&c.remove()})),r&&r.addEventListener("click",(()=>{c&&c.remove()}))}const v=new Map;class y{constructor(e){this._onPanelDisposed=e=>{e.context.model.cells.changed.disconnect(this._onCellsAltered,this)},this._hasCellListChanged=(e,t)=>{if(e.length!==t.length)return!0;for(let o=0;o<e.length;o++)if(e[o]!==t[o])return!0;return!1},this._updateCellMapping=e=>{var t,o;const n=h.getMetadataComp(null===(t=this._panel)||void 0===t?void 0:t.model,l.cellMapping);if(!n)return;const s=[];for(const[t,o]of e.entries()){const e=n.find((([e,t])=>e===o));if(e)s.push(e);else if(t>0){const e=s[t-1];s.push([o,e[1]])}else{const e=n[0];s.push([o,e[1]])}}h.setMetadataComp(null===(o=this._panel)||void 0===o?void 0:o.model,l.cellMapping,s)},this._onCellsAltered=e=>{var t;const o=h.getCellIdsComp(e);(null===(t=this._panel)||void 0===t?void 0:t.context.isReady)&&this._hasCellListChanged(o,this._cellIdList)&&this._updateCellMapping(o),this._cellIdList=o},this._isDisposed=!1,this._cellIdList=[],this._panel=e,e&&!e.isDisposed&&h.getMetadataComp(e.context.model,l.notebookId)&&h.getMetadataComp(e.context.model,l.cellMapping)&&(this._cellIdList=h.getCellIdsComp(e.context.model.cells),e.context.model.cells.changed.connect(this._onCellsAltered,this),e.disposed.connect(this._onPanelDisposed,this))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._panel=null,this._cellIdList=[],r.Signal.clearData(this))}}var D=o(930),w=o(271);const I=(e,t)=>{if(R){const o={...e,user_id:R},s=JSON.stringify(o),i=N+t;if(s.length>1048576)return void console.log(`${n}: Payload size exceeds limit of 1 Mb`);console.log(`${n}: Posting to `+t+" :\n",o),fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:s}).then((e=>{e.json().then((e=>console.log(`${n}: `+e)))}))}else console.log(`${n}: No user id`)},S=e=>{I(e,"alter")};class M{constructor(e,t){this._isDisposed=!1,this._panel=e,this._notebookId=t,_.NotebookActions.executed.connect(this._onCellExecuted,this),e.disposed.connect((()=>_.NotebookActions.executed.disconnect(this._onCellExecuted,this)))}_onCellExecuted(e,t){var o,n,s,i;const{notebook:a,cell:c}=t;var d,r;if(a===this._panel.content)if(c instanceof w.CodeCell){const e=h.getMetadataComp(c.model,"execution");if(e&&D.JSONExt.isObject(e)){const t=e["shell.execute_reply.started"]||e["iopub.execute_input"],s=e["shell.execute_reply"];if((!s||e["iopub.execute_input"])&&s&&t){const e=c.model.outputs.toJSON(),i=this._panel.model,{status:a,cell_output_length:d}=(e=>{let t=0,o="ok";for(const n of e){const e=n.output_type;if("stream"===e){const e=n.text;t+=p(e)}else"error"===e?(o="error",t+=n.evalue.length):t+="execute_result"===e||"display_data"===e?p(n.data):0}return{status:o,cell_output_length:t}})(e),u=null===(n=null===(o=h.getMetadataComp(i,l.cellMapping))||void 0===o?void 0:o.find((([e])=>e===c.model.id)))||void 0===n?void 0:n[1];u&&(r={notebook_id:this._notebookId,language_mimetype:h.getMetadataComp(i,"language_info").mimetype||"text/plain",cell_id:c.model.id,orig_cell_id:u,t_start:t,t_finish:s,status:a,cell_input:c.model.sharedModel.getSource(),cell_output_model:e,cell_output_length:d},I(r,"exec/code"))}}}else if(c instanceof w.MarkdownCell){const e=null===(i=null===(s=h.getMetadataComp(this._panel.model,l.cellMapping))||void 0===s?void 0:s.find((([e])=>e===c.model.id)))||void 0===i?void 0:i[1];e&&(d={notebook_id:this._notebookId,cell_id:c.model.id,orig_cell_id:e,time:(new Date).toISOString(),cell_content:c.model.sharedModel.getSource()},I(d,"exec/markdown"))}}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,r.Signal.clearData(this))}}class x{constructor(e,t){this._onCellsAltered=e=>{const t=h.getCellIdsComp(e),o=t.filter((e=>!this._cellIdList.includes(e))),n=this._cellIdList.filter((e=>!t.includes(e)));for(const e of o)S({notebook_id:this._notebookId,cell_id:e,alteration_type:"ADD",time:(new Date).toISOString()});for(const e of n)S({notebook_id:this._notebookId,cell_id:e,alteration_type:"REMOVE",time:(new Date).toISOString()});this._cellIdList=t},this._onPanelDisposed=e=>{e.context.model.cells.changed.disconnect(this._onCellsAltered,this)},this._isDisposed=!1,this._cellIdList=[],this._notebookId=t,this._cellIdList=h.getCellIdsComp(e.context.model.cells),e.context.model.cells.changed.connect(this._onCellsAltered,this),e.disposed.connect(this._onPanelDisposed,this)}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._cellIdList=[],r.Signal.clearData(this))}}class ${constructor(e,t){this._onContentDisposed=e=>{e.activeCellChanged.disconnect(this._onCellChanged,this),e.disposed.disconnect(this._onContentDisposed,this)},this._onCellChanged=(e,t)=>{this._sendCellClick("OFF"),this._setActiveCellAndOrigCellId(t),this._sendCellClick("ON")},this._setActiveCellAndOrigCellId=e=>{var t,o,n;this._lastActiveCellId=null==e?void 0:e.model.sharedModel.getId(),this._lastActiveCellId?this._lastOrigCellId=null===(n=null===(o=h.getMetadataComp(null===(t=this._panel)||void 0===t?void 0:t.model,l.cellMapping))||void 0===o?void 0:o.find((([e])=>e===this._lastActiveCellId)))||void 0===n?void 0:n[1]:this._lastOrigCellId=null},this._sendCellClick=e=>{if(this._lastActiveCellId){let o=null;"ON"===e?(this._cellStart=new Date,o=null):o=((new Date).getTime()-this._cellStart.getTime())/1e3,this._lastOrigCellId&&(t={notebook_id:this._notebookId,cell_id:this._lastActiveCellId,orig_cell_id:this._lastOrigCellId,click_type:e,time:(new Date).toISOString(),click_duration:o},I(t,"clickevent/cell"))}var t},this._sendNotebookClick=e=>{let t=null;var o;"ON"===e?(this._notebookStart=new Date,t=null):t=((new Date).getTime()-this._notebookStart.getTime())/1e3,o={notebook_id:this._notebookId,click_type:e,time:(new Date).toISOString(),click_duration:t},I(o,"clickevent/notebook")},this._isDisposed=!1,this._lastActiveCellId=null,this._lastOrigCellId=null,this._notebookStart=new Date,this._cellStart=new Date,this._panel=e,this._notebookId=t,this._sendNotebookClick("ON"),this._onCellChanged(e.content,e.content.activeCell),e.content.activeCellChanged.connect(this._onCellChanged,this),e.content.disposed.connect(this._onContentDisposed,this)}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._sendNotebookClick("OFF"),this._sendCellClick("OFF"),this._isDisposed=!0,this._lastActiveCellId=null,r.Signal.clearData(this))}}class O{constructor(e,t){this._ongoingContextId="",this._cellMappingDisposable=null,this._executionDisposable=null,this._alterationDisposable=null,this._focusDisposable=null,this._panel=null,this._isDataCollectionEnabled=e.get(s).composite,e.changed.connect(this._onSettingsChanged.bind(this)),V.valueChanged.connect(this._addOptionalTrackers.bind(this)),this._settings=e,this._dialogShownSettings=t,this._websocketManager=new C}_onSettingsChanged(e){this._isDataCollectionEnabled=e.get(s).composite}get websocketManager(){return this._websocketManager}get panel(){return this._panel}set panel(e){if(this._panel===e)return;if(this._panel&&this._panel.disposed.disconnect(this._onPanelDisposed,this),this._disposeFromAllTrackers(),this._panel=e,this._panel&&this._panel.disposed.connect(this._onPanelDisposed,this),!this._panel)return;const t=crypto.randomUUID();this._ongoingContextId=t,this._panel.sessionContext.ready.then((()=>{this._ongoingContextId===t&&this._panel&&!this._panel.isDisposed&&this._addAllTrackers()}))}_addAllTrackers(){this._panel&&this._panel.sessionContext.isReady&&(this._cellMappingDisposable=new y(this._panel),this._addOptionalTrackers())}_addOptionalTrackers(){if(this._disposeFromOptionalTrackers(),this._panel&&this._panel.sessionContext.isReady){const e=(e=>{if(e&&!e.isDisposed){const t=h.getMetadataComp(e.context.model,l.notebookId),o=h.getMetadataComp(e.context.model,l.cellMapping);if(t&&o)return F&&(null===V.value||V.value.includes(t))?null:t}return null})(this._panel);e&&this._showConsentDialogPromise().then((()=>{this._panel&&!this._panel.isDisposed&&this._isDataCollectionEnabled&&(this._focusDisposable=new $(this._panel,e),this._executionDisposable=new M(this._panel,e),this._alterationDisposable=new x(this._panel,e),this._websocketManager.establishSocketConnection(e,((e,t)=>{this._panel&&((e,t,o)=>{const n=t.indexOf("{");if(-1===n)return void console.error("No JSON found in payload:",t);const s=t.slice(n);try{const t=JSON.parse(s);t.action===b?f(e,{cells:[t.content]},t.action,o):t.action===k&&f(e,t.content,t.action,o)}catch(e){console.error("Error parsing JSON from sync message:",e,t)}})(this._panel,e,t)})),(async e=>{const t=await(async e=>{if(!R)return console.log(`${n}: No user id`),[];const t=`${j}/groups/users/${R}/groups/names?notebookId=${encodeURIComponent(e)}`;try{const e=await fetch(t);return e.ok?await e.json():(console.error(`Failed to fetch groups: ${e.status}`),[])}catch(e){return console.error("Error fetching user groups:",e),[]}})(e);v.set(e,t.length>0)})(e))}))}}async _showConsentDialogPromise(){if(!this._dialogShownSettings.get("DialogShown").composite){const e=await(0,g.showDialog)({title:"Unianalytics Data",hasClose:!1,body:"Enable anonymous collection of interaction data in specific notebooks to make it easier for your teacher(s) to support your learning?",buttons:[g.Dialog.okButton({label:"Yes"}),g.Dialog.cancelButton({label:"No"})]});await this._dialogShownSettings.set("DialogShown",!0);let t=!1;e.button.accept?(await this._settings.set(s,!0),t=!0):(await this._settings.set(s,!1),t=!1),this._isDataCollectionEnabled=t}}_disposeFromAllTrackers(){this._cellMappingDisposable&&(this._cellMappingDisposable.dispose(),this._cellMappingDisposable=null),this._disposeFromOptionalTrackers()}_disposeFromOptionalTrackers(){this._websocketManager.closeSocketConnection(),this._executionDisposable&&(this._executionDisposable.dispose(),this._executionDisposable=null),this._alterationDisposable&&(this._alterationDisposable.dispose(),this._alterationDisposable=null),this._focusDisposable&&(this._focusDisposable.dispose(),this._focusDisposable=null)}_onPanelDisposed(e){this._disposeFromAllTrackers(),this.panel=null}}const E="http://localhost:1015";let N=E+"/send/",j=E;const T=async(e,t)=>{var o;if(!e.websocketManager)return void console.error("No websocket manager found");const s=(async e=>{if(!R)return console.log(`${n}: No user id`),[];const t=`${j}/groups/users/${R}/teammates/connected?notebookId=${encodeURIComponent(e)}`;try{const e=await fetch(t);return e.ok?await e.json():(console.error(`Failed to fetch connected teammates: ${e.status}`),[])}catch(e){return console.error("Error fetching connected teammates:",e),[]}})(h.getMetadataComp(null===(o=e.panel)||void 0===o?void 0:o.context.model,l.notebookId));if(0!==(await s).length)for(const o of await s)e.websocketManager.sendMessageToTeammates(o,t);else console.log("No connected teammates")};function A(e){const t=e.composite.useLocalBackend,o=e.composite.backendEndpoint;t?(N=E+"/send/",j=E):"string"==typeof o?(N=o+"/send/",j=o):(N=E+"/send/",j=E)}function L(e,t){const o=e.currentWidget;if(o)if(o instanceof _.NotebookPanel){const e=o;t.panel=e}else t.panel=null}var J=o(281),U=o(572);const P=new d.LabIcon({name:`${n}:schema-icon`,svgstr:'<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="1763.000000pt" height="1611.000000pt" viewBox="0 0 1763.000000 1611.000000"\n preserveAspectRatio="xMidYMid meet">\n\n<g transform="translate(0.000000,1611.000000) scale(0.100000,-0.100000)"\nfill="#000000" stroke="none">\n<path fill="#616161" class="jp-custom-icon jp-icon3 jp-icon-selectable" d="M8220 15781 c-122 -18 -249 -116 -311 -239 l-34 -67 -5 -1265 -5\n-1265 -455 -5 c-452 -5 -455 -5 -498 -28 -110 -59 -172 -164 -172 -290 0 -121\n-76 -25 1105 -1398 812 -943 748 -872 819 -914 32 -19 58 -25 128 -28 79 -4\n93 -2 140 22 29 14 67 39 85 55 25 23 1067 1232 1298 1506 33 39 161 189 285\n333 124 144 236 283 249 309 36 70 35 160 -3 237 -35 72 -75 111 -146 145\nl-55 26 -437 3 -438 3 0 1233 c0 785 -4 1253 -10 1286 -16 82 -57 159 -119\n220 -67 67 -146 108 -232 120 -71 11 -1118 11 -1189 1z"/>\n<path fill="#616161" class="jp-custom-icon jp-icon3 jp-icon-selectable" d="M1264 12910 c-103 -21 -130 -44 -573 -489 -396 -399 -425 -431 -459\n-500 -33 -68 -36 -81 -36 -167 0 -84 3 -98 34 -161 30 -63 92 -128 921 -958\n489 -490 889 -897 889 -905 0 -8 -139 -154 -309 -324 -284 -286 -310 -316\n-330 -369 -54 -147 7 -310 141 -376 71 -36 81 -38 258 -51 74 -6 214 -17 310\n-25 96 -8 238 -19 315 -25 77 -5 158 -12 180 -15 22 -4 101 -10 175 -15 74 -5\n182 -14 240 -19 58 -6 195 -17 305 -26 110 -9 247 -20 305 -26 58 -5 164 -14\n235 -19 72 -5 180 -14 240 -20 61 -6 164 -12 230 -13 105 -1 125 2 161 21 66\n34 101 69 142 140 l37 67 -2 160 c-1 143 -9 270 -44 695 -5 69 -14 193 -19\n275 -6 83 -16 242 -25 355 -36 505 -46 645 -55 790 -6 85 -15 196 -20 247 -6\n51 -10 125 -10 165 0 88 -21 191 -50 247 -33 66 -100 123 -168 145 -79 25\n-170 19 -234 -15 -30 -16 -153 -129 -353 -326 -209 -206 -311 -301 -320 -295\n-7 4 -409 400 -892 881 -569 564 -899 885 -934 907 -78 49 -180 64 -285 44z"/>\n<path fill="#616161" class="jp-custom-icon jp-icon3 jp-icon-selectable" d="M16170 12906 c-121 -25 -117 -21 -1051 -959 -711 -715 -879 -878\n-895 -873 -10 3 -149 137 -309 297 -159 160 -303 300 -318 311 -15 11 -51 26\n-80 34 -118 31 -214 7 -298 -76 -79 -79 -93 -125 -113 -380 -9 -113 -21 -252\n-27 -310 -5 -58 -14 -163 -19 -235 -5 -71 -16 -215 -25 -320 -24 -291 -45\n-547 -55 -685 -5 -69 -14 -177 -20 -240 -30 -328 -54 -647 -54 -735 0 -88 27\n-153 90 -212 77 -74 118 -86 274 -84 74 0 167 5 205 11 39 5 138 14 220 20 83\n6 231 17 330 25 427 34 568 45 695 55 74 5 187 14 250 20 198 18 360 31 511\n40 80 5 177 14 215 20 38 5 103 10 145 10 124 0 222 37 297 111 101 100 125\n244 61 370 -10 20 -120 135 -245 255 -126 120 -259 249 -297 286 l-69 67 20\n28 c11 15 406 413 878 883 490 489 870 876 889 905 47 75 65 132 65 211 0 133\n-45 217 -192 359 -51 50 -232 227 -403 394 -345 337 -404 382 -515 400 -76 13\n-87 12 -160 -3z"/>\n<path fill="#616161" class="jp-custom-icon jp-icon3 jp-icon-selectable" d="M8375 8590 c-228 -8 -598 -37 -830 -65 -1245 -146 -2171 -506 -2432\n-945 -39 -64 -65 -161 -65 -235 1 -380 502 -732 1383 -973 624 -171 1379 -266\n2209 -278 699 -11 1303 31 1885 131 1018 174 1727 479 1977 850 249 371 -45\n775 -780 1069 -578 231 -1365 383 -2258 436 -234 14 -834 19 -1089 10z"/>\n<path fill="#616161" class="jp-custom-icon jp-icon3 jp-icon-selectable" d="M5050 5241 c0 -569 3 -836 11 -873 28 -130 117 -250 289 -389 111\n-90 274 -183 470 -270 415 -183 1027 -333 1690 -414 213 -26 415 -43 786 -65\n221 -13 833 -13 1039 0 372 24 467 31 600 45 263 27 377 42 635 85 333 55 788\n173 1055 273 548 205 879 460 950 732 13 51 15 175 15 877 0 450 -2 818 -5\n818 -2 0 -47 -25 -100 -55 -229 -132 -644 -302 -955 -390 -503 -142 -1099\n-250 -1630 -295 -69 -6 -172 -15 -230 -20 -258 -24 -782 -33 -1210 -21 -501\n13 -706 28 -1180 87 -163 21 -461 71 -590 99 -41 10 -95 21 -120 26 -65 13\n-368 89 -415 104 -22 7 -94 29 -160 50 -291 89 -672 250 -825 347 -30 19 -70\n43 -87 52 l-33 17 0 -820z m6030 -458 c119 -53 200 -155 220 -276 20 -127 -12\n-231 -98 -315 -121 -117 -298 -136 -443 -46 -189 117 -225 380 -75 542 43 46\n79 71 145 99 47 20 69 23 131 20 45 -3 93 -12 120 -24z"/>\n<path fill="#616161" class="jp-custom-icon jp-icon3 jp-icon-selectable" d="M12505 3167 c-94 -59 -379 -198 -515 -252 -656 -259 -1552 -428\n-2515 -476 -276 -13 -1032 -13 -1310 0 -520 26 -1033 88 -1450 175 -38 8 -104\n21 -145 30 -90 18 -365 88 -435 109 -320 100 -453 148 -615 219 -153 68 -315\n149 -395 198 -36 22 -68 40 -70 40 -3 0 -4 -381 -3 -847 l3 -848 23 -57 c153\n-379 846 -735 1802 -928 146 -30 192 -38 430 -74 900 -138 2028 -141 2950 -10\n276 39 585 97 742 138 51 14 127 34 168 44 233 61 561 182 760 281 301 151\n509 321 598 490 64 120 63 112 60 1007 l-3 811 -80 -50z m-1408 -1268 c69 -33\n144 -101 173 -158 46 -91 44 -239 -5 -329 -74 -137 -229 -218 -367 -192 -260\n50 -391 334 -251 547 102 155 287 209 450 132z"/>\n</g>\n</svg>\n'});let R=null;const V=new class{constructor(){this._value=null,this._valueChanged=new r.Signal(this)}set value(e){e!==this._value&&(this._value=e,this._valueChanged.emit(e))}get value(){return this._value}get valueChanged(){return this._valueChanged}};let F=!1;const z={id:`${n}:plugin`,autoStart:!0,requires:[c.ISettingRegistry],activate:(e,t)=>{console.log(`JupyterLab extension ${n} is activated!`),async function(e="",t={}){const o=U.ServerConnection.makeSettings(),n=J.URLExt.join(o.baseUrl,"jupyterlab-unianalytics-telemetry",e);let s;try{s=await U.ServerConnection.makeRequest(n,t,o)}catch(e){throw new U.ServerConnection.NetworkError(e)}const i=await s.text();if(!s.ok)throw new U.ServerConnection.ResponseError(s,i.message||i);return i}("get_user_id").then((e=>{R=e})).catch((e=>{console.error(`${n}: server extension appears to be missing.\n${e}`)})),F=e.listPlugins().some((e=>e.includes("jupyterlab_unianalytics_dashboard"))),F&&window.addEventListener("message",(e=>{e.origin===window.origin&&e.data&&"unianalytics"===e.data.identifier&&(V.value=e.data.authNotebooks)}));const o="3.1.0",s=e.version.match(/[0-9]+/g);if(s&&((e,t)=>{const o=e.split(/[^0-9]+/).map(Number),n=t.split(/[^0-9]+/).map(Number);for(let e=0;e<Math.min(o.length,n.length);e++){const t=o[e],s=n[e];if(t!==s)return t-s}const s=e.replace(/[0-9]+/g,""),i=t.replace(/[0-9]+/g,"");return s.localeCompare(i)})(e.version,o)>=0){const o=parseInt(s[0]);h.setJupyterVersion(o),(async(e,t)=>{t.load("@jupyterlab/notebook-extension:tracker").then((e=>{e.set("recordTiming",!0)})).catch((e=>console.log(`${n}: Could not force cell execution metadata recording: ${e}`)));try{const[o,s,i]=await Promise.all([t.load(`${n}:settings`),t.load(`${n}:dialogShownSettings`),t.load(`${n}:endpoint`)]);A(i),i.changed.connect(A);const c=new O(o,s),r=e.shell;r&&r.currentChanged.connect((()=>L(r,c))),e.commands.addCommand(a.pushCellUpdate,{label:"Share the Selected Cell",caption:"Share the selected cell with the connected teammates",icon:d.shareIcon,isVisible:()=>null!==c.panel,isEnabled:()=>{var e;const t=c.panel;if(t){const o=h.getMetadataComp(t.context.model,l.notebookId);return null!==(e=v.get(o))&&void 0!==e&&e}return!1},execute:()=>(async e=>{var t;const o=e.panel,n=null===(t=e.panel)||void 0===t?void 0:t.content,s=null==n?void 0:n.activeCell;if(o&&n&&s){const t=s.model,i={content:{id:u(o)[n.activeCellIndex],cell_type:t.type,source:t.toJSON().source},action:"update_cell"};await T(e,JSON.stringify(i))}})(c)}),e.contextMenu.addItem({type:"separator",selector:".jp-Cell"}),e.contextMenu.addItem({command:a.pushCellUpdate,selector:".jp-Cell"}),e.restored.then((()=>{L(r,c)}))}catch(e){console.log(`${n}: Could not load settings, error: ${e}`)}})(e,t)}else console.log(`${n}: Use a more recent version of JupyterLab (>=${o})`)}}}}]);