export const __webpack_ids__=["92353"];export const __webpack_modules__={55815:function(t,e,s){s.d(e,{Eu:()=>r,hZ:()=>a,o9:()=>c});var i=s(28105),o=s(45657);const n=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function r(t){return n[t%n.length]}function a(t,e){const s=e.getPropertyValue(`--graph-color-${t+1}`)||r(t);return(0,o.Rq)(s)}const c=(0,i.Z)((t=>n.map(((e,s)=>a(s,t)))),((t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")))},10388:function(t,e,s){s.a(t,(async function(t,i){try{s.d(e,{c:()=>m,computeStateDisplay:()=>f});var o=s(16230),n=s(38763),r=s(93836),a=s(40142),c=s(74266),u=s(45691),h=s(28598),l=s(27417),_=s(44272),d=t([r,h,a,u,c]);[r,h,a,u,c]=d.then?(await d)():d;const f=(t,e,s,i,o,n,r)=>{const a=n?.[e.entity_id];return m(t,s,i,o,a,e.entity_id,e.attributes,void 0!==r?r:e.state)},m=(t,e,s,i,d,f,m,g)=>{if(g===o.lz||g===o.nZ)return t(`state.default.${g}`);const p=(0,_.M)(f),b="counter"===p||"number"===p||"input_number"===p;if((0,h.sJ)(m,"sensor"===p?s:[])||b){if("duration"===m.device_class&&m.unit_of_measurement&&r.a_.includes(m.unit_of_measurement))try{return(0,r.LU)(e,g,m.unit_of_measurement,d?.display_precision)}catch(t){}if("monetary"===m.device_class)try{return(0,h.uf)(g,e,{style:"currency",currency:m.unit_of_measurement,minimumFractionDigits:2,...(0,h.l4)({state:g,attributes:m},d)})}catch(t){}const s=(0,h.uf)(g,e,(0,h.l4)({state:g,attributes:m},d)),i=d?.translation_key&&t(`component.${d.platform}.entity.${p}.${d.translation_key}.unit_of_measurement`)||m.unit_of_measurement;return i?`${s}${(0,l.L)(i,e)}${i}`:s}if(["date","input_datetime","time"].includes(p))try{const t=g.split(" ");if(2===t.length)return(0,c.o0)(new Date(t.join("T")),{...e,time_zone:n.c_.local},i);if(1===t.length){if(g.includes("-"))return(0,a.p6)(new Date(`${g}T00:00`),{...e,time_zone:n.c_.local},i);if(g.includes(":")){const t=new Date;return(0,u.mr)(new Date(`${t.toISOString().split("T")[0]}T${g}`),{...e,time_zone:n.c_.local},i)}}return g}catch(t){return g}if(["button","conversation","event","image","input_button","notify","scene","stt","tag","tts","wake_word","datetime"].includes(p)||"sensor"===p&&"timestamp"===m.device_class)try{return(0,c.o0)(new Date(g),e,i)}catch(t){return g}return d?.translation_key&&t(`component.${d.platform}.entity.${p}.${d.translation_key}.state.${g}`)||m.device_class&&t(`component.${p}.entity_component.${m.device_class}.state.${g}`)||t(`component.${p}.entity_component._.state.${g}`)||g};i()}catch(t){i(t)}}))},39800:function(t,e,s){s.d(e,{Z:()=>o});const i=t=>{const e=parseFloat(t);if(isNaN(e))throw new Error(`${t} is not a number`);return e};function o(t){if(!t)return null;try{if(t.endsWith("%"))return{w:100,h:i(t.substr(0,t.length-1))};const e=t.replace(":","x").split("x");return 0===e.length?null:1===e.length?{w:i(e[0]),h:1}:{w:i(e[0]),h:i(e[1])}}catch(t){}return null}},89166:function(t,e,s){s.a(t,(async function(t,i){try{s.d(e,{Nu:()=>k,V3:()=>S,Vk:()=>_,YA:()=>E,xS:()=>f,zP:()=>H});s(2394),s(81738),s(94814),s(29981),s(22960),s(6989),s(72489),s(67886),s(65451),s(46015),s(38334),s(94880),s(75643),s(29761);var o=s(44272),n=s(10388),r=s(15459),a=t([n]);n=(a.then?(await a)():a)[0];const c=["climate","humidifier","water_heater"],u=["climate","humidifier","input_datetime","water_heater","person","device_tracker"],h=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],l=(t,e)=>!t.states[e]||u.includes((0,o.M)(e)),_=(t,e,s,i,o)=>{const n={type:"history/stream",entity_ids:o,start_time:s.toISOString(),end_time:i.toISOString(),minimal_response:!0,no_attributes:!o.some((e=>l(t,e)))},r=new d(t);return t.connection.subscribeMessage((t=>e(r.processMessage(t))),n)};class d{processMessage(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;const e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,s={};for(const t of Object.keys(this.combinedHistory))s[t]=[];for(const e of Object.keys(t.states))s[e]=[];for(const i of Object.keys(s)){if(i in this.combinedHistory&&i in t.states){const e=this.combinedHistory[i],o=e[e.length-1];s[i]=e.concat(t.states[i]),t.states[i][0].lu<o.lu&&(s[i]=s[i].sort(((t,e)=>t.lu-e.lu)))}else i in this.combinedHistory?s[i]=this.combinedHistory[i]:s[i]=t.states[i];if(e&&i in this.combinedHistory){const t=s[i].filter((t=>t.lu<e));if(!t.length)continue;if(s[i]=s[i].filter((t=>t.lu>=e)),s[i].length&&s[i][0].lu===e)continue;const o=t[t.length-1];o.lu=e,s[i].unshift(o)}}return this.combinedHistory=s,this.combinedHistory}constructor(t,e){this.hass=t,this.hoursToShow=e,this.combinedHistory={}}}const f=(t,e,s,i,o,n=!0,r=!0)=>{const a={type:"history/stream",entity_ids:i,start_time:new Date((new Date).getTime()-3600*s*1e3).toISOString(),minimal_response:n,significant_changes_only:r,no_attributes:o??!i.some((e=>l(t,e)))},c=new d(t,s);return t.connection.subscribeMessage((t=>e(c.processMessage(t))),a)},m=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||h.every((s=>t.attributes[s]===e.attributes[s]))),g=(t,e,s,i,o,a,c)=>{const u=[],h=a[0];for(const r of a){if(u.length>0&&r.s===u[u.length-1].state)continue;const a={};c?.attributes.device_class&&(a.device_class=c?.attributes.device_class),u.push({state_localize:(0,n.c)(t,e,[],s,i[o],o,{...r.a||h.a,...a},r.s),state:r.s,last_changed:1e3*(r.lc?r.lc:r.lu)})}return{name:(0,r.a)(o,c?.attributes||h.a),entity_id:o,data:u}},p=(t,e,s,i)=>{const n=[];return Object.keys(s).forEach((t=>{const e=s[t],a=e[0],u=(0,o.M)(t),l=[];for(const t of e){let e;if(c.includes(u)){e={state:t.s,last_changed:1e3*t.lu,attributes:{}};for(const s of h)s in t.a&&(e.attributes[s]=t.a[s])}else e={state:t.s,last_changed:1e3*(t.lc?t.lc:t.lu),attributes:{}};l.length>1&&m(e,l[l.length-1])&&m(e,l[l.length-2])||l.push(e)}const _=t in i?i[t].attributes:"friendly_name"in a.a?a.a:void 0;n.push({domain:u,name:(0,r.a)(t,_||{}),entity_id:t,states:l})})),{unit:t,device_class:e,identifier:Object.keys(s).join(""),data:n}},b=["counter","input_number","number"],y=t=>b.includes(t),w=t=>"unit_of_measurement"in t||"state_class"in t,v=(t,e)=>null!=t.attributes.device_class&&e.includes(t.attributes.device_class),M=" ",E=(t,e,s,i,o=!1)=>{const n={};s.forEach((t=>{t in e&&(n[t]=e[t])}));const r={};Object.entries(n).forEach((([t,e])=>{const s=e.map((t=>({s:null!=t.mean?t.mean.toString():t.state.toString(),lc:t.start/1e3,a:{},lu:t.start/1e3})));r[t]=s}));const a=k(t,r,[],t.localize,i,o,!0);return(a?.line||[]).forEach((t=>{t.data.forEach((t=>{t.statistics=t.states,t.states=[]}))})),a},k=(t,e,s,i,n,r=!1,a=!1)=>{const c={},u=[],h={};if(new Set([...s,...Object.keys(e)]).forEach((s=>{s in e?h[s]=e[s]:t.states[s]&&(h[s]=[{s:t.states[s].state,a:t.states[s].attributes,lu:new Date(t.states[s].last_updated).getTime()/1e3}])})),!h)return{line:[],timeline:[]};Object.keys(h).forEach((e=>{const s=h[e];if(0===s.length)return;const l=(0,o.M)(e),_=e in t.states?t.states[e]:void 0,d=_||y(l)?void 0:s.find((t=>t.a&&w(t.a)));let f;f=H(l,_,d,n,a)?_?.attributes.unit_of_measurement||d?.a.unit_of_measurement||M:{zone:i("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[l];const m=$(f,{climate:"temperature",humidifier:"humidity",water_heater:"temperature"}[l]||(_?.attributes||d?.a)?.device_class,r);f?m&&m in c&&e in c[m]?c[m][e].push(...s):m&&(m in c||(c[m]={}),c[m][e]=s):u.push(g(i,t.locale,t.config,t.entities,e,s,_))}));return{line:Object.keys(c).map((e=>{const s=e.split("_"),i=s[0],o=s[1]||void 0;return p(i,o,c[e],t.states)})),timeline:u}},$=(t,e,s)=>s?`${t}_${e||""}`:t,H=(t,e,s,i,o=!1)=>o||y(t)||null!=e&&w(e.attributes)||null!=e&&"sensor"===t&&v(e,i)||null!=s,S=(t,e,s=!0)=>{if(!e)return t;const i={...t,line:[]},o={};for(const e of t.line){const t=$(e.unit,e.device_class,s);t&&(o[t]={historyItem:e})}for(const t of e.line){const e=$(t.unit,t.device_class,s);e&&(e in o?o[e].ltsItem=t:o[e]={ltsItem:t})}for(const{historyItem:t,ltsItem:e}of Object.values(o)){if(!t||!e){i.line.push(t||e);continue}const s={...t,data:[]},o=new Set([...t.data.map((t=>t.entity_id)),...e.data.map((t=>t.entity_id))]);for(const i of o){const o=t.data.find((t=>t.entity_id===i)),n=e.data.find((t=>t.entity_id===i));if(!o||!n){s.data.push(o||n);continue}const r=o.states[0]?.last_changed||n.statistics[n.statistics.length-1].last_changed+1,a=[];for(const t of n.statistics){if(t.last_changed>=r)break;a.push(t)}s.data.push(0===a.length?o:{...o,statistics:a})}i.line.push(s)}return i};i()}catch(t){i(t)}}))},70963:function(t,e,s){s.a(t,(async function(t,i){try{s.r(e),s.d(e,{DEFAULT_HOURS_TO_SHOW:()=>k,DEFAULT_ZOOM:()=>$});s(2394),s(81738),s(29981),s(22960),s(6989),s(67886),s(65451),s(46015),s(38334),s(94880),s(75643),s(29761);var o=s(73742),n=s(59048),r=s(26292),a=s(28105),c=s(55815),u=s(37528),h=s(44272),l=s(6219),_=s(15459),d=s(65829),f=s(39800),m=(s(12942),s(31138),s(48017),s(42031)),g=s(89166),p=s(45063),b=s(93647),y=s(55577),w=t([m,g]);[m,g]=w.then?(await w)():w;const v="M16 12C16 10.9 16.9 10 18 10S20 10.9 20 12 19.1 14 18 14 16 13.1 16 12M10 12C10 10.9 10.9 10 12 10S14 10.9 14 12 13.1 14 12 14 10 13.1 10 12M4 12C4 10.9 4.9 10 6 10S8 10.9 8 12 7.1 14 6 14 4 13.1 4 12M13 18C13 16.9 13.9 16 15 16S17 16.9 17 18 16.1 20 15 20 13 19.1 13 18M7 18C7 16.9 7.9 16 9 16S11 16.9 11 18 10.1 20 9 20 7 19.1 7 18M13 6C13 4.9 13.9 4 15 4S17 4.9 17 6 16.1 8 15 8 13 7.1 13 6M7 6C7 4.9 7.9 4 9 4S11 4.9 11 6 10.1 8 9 8 7 7.1 7 6",M="M15,12C13.89,12 13,12.89 13,14A2,2 0 0,0 15,16A2,2 0 0,0 17,14C17,12.89 16.1,12 15,12M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M14,9C14,7.89 13.1,7 12,7C10.89,7 10,7.89 10,9A2,2 0 0,0 12,11A2,2 0 0,0 14,9M9,12A2,2 0 0,0 7,14A2,2 0 0,0 9,16A2,2 0 0,0 11,14C11,12.89 10.1,12 9,12Z",E="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M19,19H15V21H19A2,2 0 0,0 21,19V15H19M19,3H15V5H19V9H21V5A2,2 0 0,0 19,3M5,5H9V3H5A2,2 0 0,0 3,5V9H5M5,15H3V19A2,2 0 0,0 5,21H9V19H5V15Z",k=0,$=14;class H extends n.oi{_getAllEntities(){const t=this.hass,e=new Set,s=[];return Object.values(t.states).forEach((t=>{"latitude"in t.attributes&&"longitude"in t.attributes&&(s.push(t.entity_id),"person"===(0,l.N)(t)&&t.attributes.source&&e.add(t.attributes.source))})),s.filter((t=>!e.has(t)))}setConfig(t){if(!t)throw new Error("Error in card configuration.");if(!t.show_all&&!t.entities?.length&&!t.geo_location_sources)throw new Error("Either show_all, entities, or geo_location_sources must be specified");if(t.entities&&!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(t.geo_location_sources&&!Array.isArray(t.geo_location_sources))throw new Error("Parameter geo_location_sources needs to be an array");if(t.show_all&&(t.entities||t.geo_location_sources))throw new Error("Cannot specify show_all and entities or geo_location_sources");this._config={...t},this.hass&&t.show_all&&(this._config.entities=this._getAllEntities()),this._configEntities=this._config.entities?(0,y.A)(this._config.entities):[],this._mapEntities=this._getMapEntities(),this._clusterMarkers=this._config.cluster??!0}getCardSize(){if(!this._config?.aspect_ratio)return 7;const t=(0,f.Z)(this._config.aspect_ratio),e=t&&t.w>0&&t.h>0?`${(100*t.h/t.w).toFixed(2)}`:"100";return 1+Math.floor(Number(e)/25)||3}static async getConfigElement(){return await Promise.all([s.e("73614"),s.e("86689"),s.e("22549"),s.e("15634"),s.e("26452"),s.e("20278"),s.e("42382"),s.e("89112"),s.e("19596"),s.e("1020"),s.e("35598")]).then(s.bind(s,95482)),document.createElement("hui-map-card-editor")}static getStubConfig(t,e,s){return{type:"map",entities:(0,p.j)(t,2,e,s,["device_tracker"]),theme_mode:"auto"}}render(){if(!this._config)return n.Ld;if(this._error)return n.dy`<ha-alert alert-type="error"> ${this.hass.localize("ui.components.map.error")}: ${this._error.message} (${this._error.code}) </ha-alert>`;const t=!(!this._config.dark_mode&&"dark"!==this._config.theme_mode)||"light"!==this._config.theme_mode&&this.hass.themes.darkMode,e=this._config.theme_mode||(this._config.dark_mode?"dark":"auto");return n.dy` <ha-card id="card" .header="${this._config.title}"> <div id="root"> <ha-map .hass="${this.hass}" .entities="${this._mapEntities}" .zoom="${this._config.default_zoom??$}" .paths="${this._getHistoryPaths(this._config,this._stateHistory)}" .autoFit="${this._config.auto_fit||!1}" .fitZones="${this._config.fit_zones||!1}" .themeMode="${e}" .clusterMarkers="${this._clusterMarkers}" interactive-zones render-passive></ha-map> <div id="buttons"> ${this._mapEntities.length>1?n.dy` <ha-icon-button .label="${this.hass.localize("ui.panel.lovelace.cards.map.toggle_grouping")}" .path="${this._clusterMarkers?M:v}" style="${t?"color:#ffffff":"color:#000000"}" @click="${this._toggleClusterMarkers}" tabindex="0"></ha-icon-button> `:n.Ld} <ha-icon-button .label="${this.hass.localize("ui.panel.lovelace.cards.map.reset_focus")}" .path="${E}" style="${t?"color:#ffffff":"color:#000000"}" @click="${this._fitMap}" tabindex="0"></ha-icon-button> </div> </div> </ha-card> `}shouldUpdate(t){if(!t.has("hass")||t.size>1)return!0;const e=t.get("hass");return!e||!this._configEntities||(e.themes.darkMode!==this.hass.themes.darkMode||(!!t.has("_stateHistory")||(!(!this._config?.geo_location_sources||e.states===this.hass.states)||(this._config?.entities?(0,b.Wh)(this,t):(0,b.SN)(this,t)))))}willUpdate(t){super.willUpdate(t),this._config?.show_all&&!this._config?.entities&&this.hass&&t.has("hass")&&(this._config.entities=this._getAllEntities(),this._configEntities=(0,y.A)(this._config.entities),this._mapEntities=this._getMapEntities()),t.has("hass")&&this._config?.geo_location_sources&&!(0,d.v)(this._getSourceEntities(t.get("hass")?.states),this._getSourceEntities(this.hass.states))&&(this._mapEntities=this._getMapEntities())}connectedCallback(){super.connectedCallback(),this.hasUpdated&&this._configEntities?.length&&this._subscribeHistory()}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeHistory()}_subscribeHistory(){(0,u.p)(this.hass,"history")&&!this._subscribed&&(this._config?.hours_to_show??k)&&(this._subscribed=(0,g.xS)(this.hass,(t=>{this._subscribed&&(this._stateHistory=t)}),this._config.hours_to_show??k,(this._configEntities||[]).map((t=>t.entity)),!1,!1,!1).catch((t=>{this._subscribed=void 0,this._error=t})))}_unsubscribeHistory(){this._subscribed&&(this._subscribed.then((t=>t?.())),this._subscribed=void 0)}updated(t){this._configEntities?.length?this._subscribed&&!t.has("_config")||(this._unsubscribeHistory(),this._subscribeHistory()):this._unsubscribeHistory(),t.has("_config")&&this._computePadding()}_computePadding(){const t=this.shadowRoot.getElementById("root"),e="panel"===this.layout||"grid"===this.layout;if(!this._config||e||!t)return;if(!this._config.aspect_ratio)return void(t.style.paddingBottom="100%");t.style.height="auto";const s=(0,f.Z)(this._config.aspect_ratio);t.style.paddingBottom=s&&s.w>0&&s.h>0?`${(100*s.h/s.w).toFixed(2)}%`:t.style.paddingBottom="100%"}_fitMap(){this._map?.fitMap()}_toggleClusterMarkers(){this._clusterMarkers=!this._clusterMarkers}_getColor(t){let e=this._colorDict[t];return e||(e=(0,c.Eu)(this._colorIndex),this._colorIndex++,this._colorDict[t]=e,e)}_getSourceEntities(t){if(!t||!this._config?.geo_location_sources)return[];const e=this._config.geo_location_sources.map((t=>"string"==typeof t?{source:t}:t)),s=[],i=e.find((t=>"all"===t.source));for(const o of Object.values(t)){const t=e.find((t=>t.source===o.attributes.source));"geo_location"===(0,h.M)(o.entity_id)&&(i||t)&&s.push({entity_id:o.entity_id,label_mode:t?.label_mode??i?.label_mode,attribute:t?.attribute??i?.attribute,focus:t?t.focus??!0:i?.focus??!0})}return s}_getMapEntities(){return[...(this._configEntities||[]).map((t=>({entity_id:t.entity,color:this._getColor(t.entity),label_mode:t.label_mode,attribute:t.attribute,focus:t.focus,name:t.name}))),...this._getSourceEntities(this.hass?.states).map((t=>({...t,color:this._getColor(t.entity_id)})))]}getGridOptions(){return{columns:"full",rows:4,min_columns:6,min_rows:2}}constructor(...t){super(...t),this._mapEntities=[],this._colorDict={},this._colorIndex=0,this._clusterMarkers=!0,this._getHistoryPaths=(0,a.Z)(((t,e)=>{if(!e||!(t.hours_to_show??k))return;const s=[];for(const i of Object.keys(e)){if("zone"===(0,h.M)(i))continue;const o=e[i];if(!o?.length)continue;const n=[];for(const t of o){const e=t.a.latitude,s=t.a.longitude;if(!e||!s)continue;const i={};i.point=[e,s],i.timestamp=new Date(1e3*t.lu),n.push(i)}const r=this._configEntities?.find((t=>t.entity===i)),a=r?.name??(i in this.hass.states?(0,_.C)(this.hass.states[i]):i);s.push({points:n,name:a,fullDatetime:(t.hours_to_show??k)>144,color:this._getColor(i),gradualOpacity:.8})}return s}))}}H.styles=n.iv`ha-card{overflow:hidden;width:100%;height:100%;display:flex;flex-direction:column}ha-map{z-index:0;border:none;position:absolute;top:0;left:0;width:100%;height:100%;background:inherit;border-radius:var(--ha-card-border-radius,12px);overflow:hidden}#buttons{position:absolute;top:75px;left:3px;display:flex;flex-direction:column}#root{position:relative;height:100%}`,(0,o.__decorate)([(0,r.Cb)({attribute:!1})],H.prototype,"hass",void 0),(0,o.__decorate)([(0,r.Cb)({attribute:!1})],H.prototype,"layout",void 0),(0,o.__decorate)([(0,r.SB)()],H.prototype,"_stateHistory",void 0),(0,o.__decorate)([(0,r.SB)()],H.prototype,"_config",void 0),(0,o.__decorate)([(0,r.IO)("ha-map")],H.prototype,"_map",void 0),(0,o.__decorate)([(0,r.SB)()],H.prototype,"_mapEntities",void 0),(0,o.__decorate)([(0,r.SB)()],H.prototype,"_error",void 0),(0,o.__decorate)([(0,r.SB)()],H.prototype,"_clusterMarkers",void 0),H=(0,o.__decorate)([(0,r.Mo)("hui-map-card")],H),i()}catch(t){i(t)}}))}};
//# sourceMappingURL=92353.c361ce4ce51c8252.js.map