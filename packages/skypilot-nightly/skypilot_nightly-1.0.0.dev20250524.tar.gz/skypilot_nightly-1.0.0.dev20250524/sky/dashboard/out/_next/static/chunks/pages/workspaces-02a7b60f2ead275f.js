(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[590],{2592:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/workspaces",function(){return a(9434)}])},9434:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return y}});var l=a(5893),t=a(7294),n=a(9470),r=a(1163),c=a(3266),i=a(8969),o=a(7324),d=a(7673),x=a(803),m=a(8799),u=a(3320),h=a.n(u),p=a(326),f=a(3850),g=a(3626),j=a(3001),N=a(938);function b(){let[e,s]=(0,t.useState)([]),[a,n]=(0,t.useState)(0),[u,b]=(0,t.useState)(0),[y,k]=(0,t.useState)(0),[w,C]=(0,t.useState)(0),[v,E]=(0,t.useState)(!0);(0,r.useRouter)();let[S,_]=(0,t.useState)(!1),[W,O]=(0,t.useState)(null),[R,z]=(0,t.useState)(""),[D,T]=(0,t.useState)(null),[A,J]=(0,t.useState)(!1),V=(0,j.X)(),Z=async()=>{E(!0);try{let[e,a,l]=await Promise.all([(0,o.f)(),(0,c.zd)(),(0,i.Vp)()]);console.log("[Workspaces Debug] Raw fetchedWorkspacesConfig:",e),T(e);let t=Object.keys(e);console.log("[Workspaces Debug] configuredWorkspaceNames:",t);let r=t.map(e=>(0,o.y)(e)),d=await Promise.all(r),x={};t.forEach((e,s)=>{x[e]=d[s]}),console.log("[Workspaces Debug] Enabled clouds by workspace:",x);let m={};a.forEach(e=>{m[e.cluster]=e.workspace||"default"});let u=0,h={};t.length>0&&t.forEach(e=>{h[e]={name:e,totalClusterCount:0,runningClusterCount:0,managedJobsCount:0,clouds:new Set,hourlyCost:0}}),a.forEach(e=>{let s=e.workspace||"default";t.length>0&&h[s],h[s]||(h[s]={name:s,totalClusterCount:0,runningClusterCount:0,managedJobsCount:0,clouds:new Set,hourlyCost:0}),h[s].totalClusterCount++,("RUNNING"===e.status||"LAUNCHING"===e.status)&&(h[s].runningClusterCount++,u++),e.cloud&&h[s].clouds.add(e.cloud)}),b(a.length),n(u);let p=l.jobs||[],f=new Set(N.x2.active),g=0;p.forEach(e=>{let s=e.cluster_name||e.resources&&e.resources.cluster_name;if(s){let a=m[s];a&&h[a]&&f.has(e.status)&&h[a].managedJobsCount++}f.has(e.status)&&g++}),k(g);let j=Object.values(h).map(e=>{let s=x[e.name]||[];return{...e,clouds:Array.isArray(s)?s.sort():[]}});t.length>0&&(j=j.filter(e=>t.includes(e.name))),j.sort((e,s)=>e.name.localeCompare(s.name)),console.log("[Workspaces Debug] finalWorkspaceDetails before setting state:",j),s(j)}catch(e){console.error("Error fetching comprehensive workspace data:",e),s([]),n(0),b(0),k(0)}E(!1)};(0,t.useEffect)(()=>{Z()},[]);let I=e=>{D&&D[e]?(O({[e]:D[e]}),z(e),_(!0)):console.error("Configuration not found for workspace: ".concat(e))},P={backgroundColor:"#f5f5f5",padding:"16px",borderRadius:"8px",overflowX:"auto",whiteSpace:"pre",wordBreak:"normal"};return v&&0===e.length?(0,l.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,l.jsx)(m.Z,{}),(0,l.jsx)("span",{className:"ml-2 text-gray-500",children:"Loading workspace data..."})]}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4 h-5",children:[(0,l.jsxs)("div",{className:"text-base flex items-center",children:[(0,l.jsx)("span",{className:"text-sky-blue leading-none",children:"Workspaces"}),(0,l.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>{D&&Object.keys(D).length>0?J(!0):console.warn("Raw workspaces data is not available or empty.")},className:"ml-4 px-2 py-1 text-xs",disabled:v||!D||0===Object.keys(D).length,children:"View All Configs"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[v&&(0,l.jsxs)("div",{className:"flex items-center mr-2",children:[(0,l.jsx)(m.Z,{size:15,className:"mt-0"}),(0,l.jsx)("span",{className:"ml-2 text-gray-500 text-xs",children:"Refreshing..."})]}),(0,l.jsxs)(x.z,{variant:"ghost",onClick:()=>{Z()},disabled:v,className:"text-sky-blue hover:text-sky-blue-bright flex items-center",children:[(0,l.jsx)(g.Z,{className:"h-4 w-4 mr-1.5"}),!V&&(0,l.jsx)("span",{children:"Refresh"})]})]})]}),(0,l.jsx)("div",{className:"bg-sky-50 p-4 rounded-lg shadow mb-6",children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row justify-around items-center",children:[(0,l.jsx)("div",{className:"p-2",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(f.E9,{className:"w-5 h-5 mr-2 text-sky-600"}),(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"Workspaces:"}),(0,l.jsx)("span",{className:"ml-1 text-xl font-semibold text-sky-700",children:e.length})]})}),(0,l.jsx)("div",{className:"p-2",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(f.QT,{className:"w-5 h-5 mr-2 text-sky-600"}),(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"Clusters (Running / Total):"}),(0,l.jsxs)("span",{className:"ml-1 text-xl font-semibold text-sky-700",children:[a," / ",u]})]})}),(0,l.jsx)("div",{className:"p-2",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(f.Vp,{className:"w-5 h-5 mr-2 text-sky-600"}),(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"Managed Jobs:"}),(0,l.jsx)("span",{className:"ml-1 text-xl font-semibold text-sky-700",children:y})]})})]})}),0!==e.length||v?(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,l.jsxs)(d.Zb,{children:[(0,l.jsx)(d.Ol,{children:(0,l.jsxs)(d.ll,{className:"text-base font-normal",children:[(0,l.jsx)("span",{className:"font-semibold",children:"Workspace:"})," ",e.name]})}),(0,l.jsxs)(d.aY,{className:"text-sm pb-2",children:[(0,l.jsxs)("div",{className:"py-2 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,l.jsx)(f.QT,{className:"w-4 h-4 mr-2 text-gray-500"}),(0,l.jsx)("span",{children:"Clusters (Running / Total)"})]}),(0,l.jsxs)("span",{className:"font-normal text-gray-800",children:[e.runningClusterCount," / ",e.totalClusterCount]})]}),(0,l.jsxs)("div",{className:"py-2 flex items-center justify-between border-t border-gray-100",children:[(0,l.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,l.jsx)(f.Vp,{className:"w-4 h-4 mr-2 text-gray-500"}),(0,l.jsx)("span",{children:"Managed Jobs"})]}),(0,l.jsx)("span",{className:"font-normal text-gray-800",children:e.managedJobsCount})]})]}),(0,l.jsxs)("div",{className:"px-6 pb-3 text-sm pt-3",children:[(0,l.jsx)("h4",{className:"mb-2 text-xs text-gray-500 tracking-wider",children:"Enabled Infra"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-x-4 gap-y-1",children:e.clouds.map(e=>(0,l.jsxs)("div",{className:"flex items-center text-gray-700",children:[(0,l.jsx)(f.Ye,{className:"w-3.5 h-3.5 mr-1.5 text-green-500"}),(0,l.jsx)("span",{children:e})]},e))})]}),(0,l.jsx)(d.eW,{className:"flex justify-end pt-3",children:(0,l.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>I(e.name),children:"Details"})})]},e.name))}):(0,l.jsxs)("div",{className:"text-center py-10",children:[(0,l.jsx)("p",{className:"text-lg text-gray-600",children:"No workspaces found."}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Create a cluster to see its workspace here."})]}),W&&(0,l.jsx)(p.Vq,{open:S,onOpenChange:()=>{_(!1),O(null),z("")},children:(0,l.jsxs)(p.cZ,{className:"sm:max-w-md md:max-w-lg lg:max-w-xl xl:max-w-2xl w-full max-h-[90vh] flex flex-col",children:[(0,l.jsx)(p.fK,{children:(0,l.jsxs)(p.$N,{className:"pr-10",children:["Workspace:",(0,l.jsxs)("span",{className:"font-normal",children:[" ",R]})]})}),(0,l.jsxs)("div",{className:"flex-grow overflow-y-auto py-4",children:[W&&R&&D&&D[R]&&(0,l.jsx)(e=>{let{workspaceName:s,config:a}=e;if(!a)return null;let t="default"===s,n=0===Object.keys(a).length;if(t&&n)return(0,l.jsx)("p",{className:"text-sm text-gray-500 mb-3 italic p-3 bg-sky-50 rounded border border-sky-200",children:"Workspace 'default' can use all accessible infrastructure."});let r=[],c=[];for(let e in a){let s=a[e],t=e.toUpperCase();if(s&&!0===s.disabled)c.push(t);else if(s&&Object.keys(s).length>0){let a="";"gcp"===e.toLowerCase()&&s.project_id?a=" (Project ID: ".concat(s.project_id,")"):"aws"===e.toLowerCase()&&s.region&&(a=" (Region: ".concat(s.region,")")),r.push((0,l.jsxs)("span",{className:"block",children:[t,a," is enabled."]},"".concat(e,"-enabled")))}else s&&0===Object.keys(s).length&&r.push((0,l.jsxs)("span",{className:"block",children:[t," is enabled (using default settings)."]},"".concat(e,"-default-enabled")))}let i=[];if(c.length>0){let e=c.join(" and ");i.push((0,l.jsxs)("span",{className:"block",children:[e," ",1===c.length?"is":"are"," ","explicitly disabled."]},"disabled-clouds"))}return(i.push(...r),i.length>0)?(0,l.jsxs)("div",{className:"text-sm text-gray-700 mb-3 p-3 bg-sky-50 rounded border border-sky-200",children:[i,(0,l.jsxs)("p",{className:"mt-2 text-gray-500",children:["Other accessible infrastructure are enabled. See"," ",(0,l.jsx)("code",{className:"text-sky-blue",children:"Enabled Infra"}),"."]})]}):!t&&n?(0,l.jsx)("p",{className:"text-sm text-gray-500 mb-3 italic p-3 bg-sky-50 rounded border border-sky-200",children:"This workspace has no specific cloud resource configurations and can use all accessible infrastructure."}):null},{workspaceName:R,config:D[R]}),(0,l.jsx)("pre",{style:P,children:h().dump(W,{indent:2})})]})]})}),D&&(0,l.jsx)(p.Vq,{open:A,onOpenChange:()=>{J(!1)},children:(0,l.jsxs)(p.cZ,{className:"sm:max-w-md md:max-w-lg lg:max-w-xl xl:max-w-2xl w-full max-h-[90vh] flex flex-col",children:[(0,l.jsx)(p.fK,{children:(0,l.jsx)(p.$N,{className:"pr-10",children:"All Workspaces Configuration"})}),(0,l.jsx)("div",{className:"flex-grow overflow-y-auto py-4",children:(0,l.jsx)("pre",{style:P,children:h().dump(D,{indent:2})})})]})})]})}function y(){return(0,l.jsx)(n.A,{highlighted:"workspaces",children:(0,l.jsx)(b,{})})}}},function(e){e.O(0,[146,573,488,498,480,734,938,888,774,179],function(){return e(e.s=2592)}),_N_E=e.O()}]);