(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892],{7476:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/users",function(){return r(7823)}])},803:function(e,t,r){"use strict";r.d(t,{z:function(){return i}});var s=r(5893),n=r(7294),a=r(8426),o=r(2003),c=r(2350);let l=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),i=n.forwardRef((e,t)=>{let{className:r,variant:n,size:o,asChild:i=!1,...u}=e,d=i?a.g7:"button";return(0,s.jsx)(d,{className:(0,c.cn)(l({variant:n,size:o,className:r})),ref:t,...u})});i.displayName="Button"},7673:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},Zb:function(){return l},aY:function(){return f},eW:function(){return m},ll:function(){return u}});var s=r(5893),n=r(7294),a=r(5697),o=r.n(a),c=r(2350);let l=n.forwardRef((e,t)=>{let{className:r,children:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a,children:n})});l.displayName="Card",l.propTypes={className:o().string,children:o().node};let i=n.forwardRef((e,t)=>{let{className:r,children:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",r),...a,children:n})});i.displayName="CardHeader",i.propTypes={className:o().string,children:o().node};let u=n.forwardRef((e,t)=>{let{className:r,children:n,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a,children:n})});u.displayName="CardTitle",u.propTypes={className:o().string,children:o().node};let d=n.forwardRef((e,t)=>{let{className:r,children:n,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,c.cn)("text-sm text-muted-foreground",r),...a,children:n})});d.displayName="CardDescription",d.propTypes={className:o().string,children:o().node};let f=n.forwardRef((e,t)=>{let{className:r,children:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,c.cn)("p-6 pt-0",r),...a,children:n})});f.displayName="CardContent",f.propTypes={className:o().string,children:o().node};let m=n.forwardRef((e,t)=>{let{className:r,children:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,c.cn)("flex items-center p-6 pt-0",r),...a,children:n})});m.displayName="CardFooter",m.propTypes={className:o().string,children:o().node}},8764:function(e,t,r){"use strict";r.d(t,{RM:function(){return l},SC:function(){return i},iA:function(){return o},pj:function(){return d},ss:function(){return u},xD:function(){return c}});var s=r(5893),n=r(7294),a=r(2350);let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,a.cn)("w-full caption-bottom text-base",r),...n})})});o.displayName="Table";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("thead",{ref:t,className:(0,a.cn)("[&_tr]:border-b",r),...n})});c.displayName="TableHeader";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,a.cn)("[&_tr:last-child]:border-0",r),...n})});l.displayName="TableBody",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,a.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...n})}).displayName="TableFooter";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("tr",{ref:t,className:(0,a.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...n})});i.displayName="TableRow";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("th",{ref:t,className:(0,a.cn)("h-12 px-4 text-left align-middle font-medium text-[hsl(var(--text-strong))] [&:has([role=checkbox])]:pr-0",r),...n})});u.displayName="TableHead";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("td",{ref:t,className:(0,a.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...n})});d.displayName="TableCell",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("caption",{ref:t,className:(0,a.cn)("mt-4 text-base text-muted-foreground",r),...n})}).displayName="TableCaption"},3266:function(e,t,r){"use strict";r.d(t,{QL:function(){return u},Sl:function(){return l},zd:function(){return c}});var s=r(7294),n=r(5821),a=r(3225);let o={UP:"RUNNING",STOPPED:"STOPPED",INIT:"LAUNCHING",null:"TERMINATED"};async function c(){let{clusterNames:e=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=await fetch("".concat(a.f4,"/status"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cluster_names:e,all_users:!0})}),r=t.headers.get("X-Skypilot-Request-ID")||t.headers.get("X-Request-ID"),s=await fetch("".concat(a.f4,"/api/get?request_id=").concat(r)),n=await s.json();return(n.return_value?JSON.parse(n.return_value):[]).map(e=>{let t="",r=t=e.zone?e.zone:e.region;return t&&t.length>25&&(t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;if(!e||e.length<=t)return e;if(t<=3)return"...";let r=Math.floor((t-3)/2),s=r+(t-3)%2;return 0===r?e.substring(0,s)+"...":e.substring(0,s)+"..."+e.substring(e.length-r)}(t,25)),{status:o[e.status],cluster:e.name,user:e.user_name,user_hash:e.user_hash,cloud:e.cloud,infra:t?e.cloud+" ("+t+")":e.cloud,full_infra:r?"".concat(e.cloud," (").concat(r,")"):e.cloud,cpus:e.cpus,mem:e.memory,gpus:e.accelerators,resources_str:e.resources_str,resources_str_full:e.resources_str_full,time:new Date(1e3*e.launched_at),num_nodes:e.nodes,workspace:e.workspace,jobs:[],events:[{time:new Date(1e3*e.launched_at),event:"Cluster created."}]}})}catch(e){return console.error("Error fetching clusters:",e),[]}}async function l(e){let{clusterName:t,jobId:r,onNewLog:s,workspace:o}=e;try{let e=(await fetch("".concat(a.f4,"/logs"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({follow:!1,cluster_name:t,job_id:r,override_skypilot_config:{active_workspace:o||"default"}})})).body.getReader();for(;;){let{done:t,value:r}=await e.read();if(t)break;let n=new TextDecoder().decode(r);s(n)}}catch(e){console.error("Error in streamClusterJobLogs:",e),(0,n.C)("Error in streamClusterJobLogs: ".concat(e.message),"error")}}async function i(e){let{clusterName:t,workspace:r}=e;try{let e=await fetch("".concat(a.f4,"/queue"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cluster_name:t,all_users:!0,override_skypilot_config:{active_workspace:r}})}),s=e.headers.get("X-Skypilot-Request-ID")||e.headers.get("X-Request-ID"),n=await fetch("".concat(a.f4,"/api/get?request_id=").concat(s)),o=await n.json();return JSON.parse(o.return_value).map(e=>{let r=e.end_at?e.end_at:Date.now()/1e3,s=0,n=0;return e.submitted_at&&(s=r-e.submitted_at),e.start_at&&(n=r-e.start_at),{id:e.job_id,status:e.status,job:e.job_name,user:e.username,gpus:e.accelerators||{},submitted_at:e.submitted_at?new Date(1e3*e.submitted_at):null,resources:e.resources,cluster:t,total_duration:s,job_duration:n,infra:"",logs:""}})}catch(e){return console.error("Error fetching cluster jobs:",e),[]}}function u(e){let{cluster:t,job:r=null}=e,[n,a]=(0,s.useState)(null),[o,l]=(0,s.useState)(null),[u,d]=(0,s.useState)(!0),[f,m]=(0,s.useState)(!0),p=(0,s.useCallback)(async()=>{if(t)try{d(!0);let e=await c({clusterNames:[t]});return a(e[0]),e[0]}catch(e){console.error("Error fetching cluster data:",e)}finally{d(!1)}return null},[t]),h=(0,s.useCallback)(async e=>{if(t)try{m(!0);let r=await i({clusterName:t,workspace:e||"default"});l(r)}catch(e){console.error("Error fetching cluster job data:",e)}finally{m(!1)}},[t]),b=(0,s.useCallback)(async()=>{let e=await p();e&&await h(e.workspace)},[p,h]);return(0,s.useEffect)(()=>{(async()=>{let e=await p();e&&await h(e.workspace)})()},[t,r,p,h]),{clusterData:n,clusterJobData:o,loading:u||f,refreshData:b}}},8969:function(e,t,r){"use strict";r.d(t,{Ce:function(){return i},NJ:function(){return l},Pr:function(){return c},Vp:function(){return o}});var s=r(7294),n=r(5821),a=r(3225);async function o(){let{allUsers:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=(await fetch("".concat(a.f4,"/jobs/queue"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({all_users:e})})).headers.get("X-Skypilot-Request-ID"),r=await fetch("".concat(a.f4,"/api/get?request_id=").concat(t));if(500===r.status){try{let e=await r.json();if(e.detail&&e.detail.error)try{let t=JSON.parse(e.detail.error);if(t.type&&t.type===a.iW)return{jobs:[],controllerStopped:!0}}catch(e){console.error("Error parsing JSON:",e)}}catch(e){console.error("Error parsing JSON:",e)}return{jobs:[],controllerStopped:!1}}let s=await r.json();return{jobs:(s.return_value?JSON.parse(s.return_value):[]).map(e=>{let t=[];e.submitted_at&&t.push({time:new Date(1e3*e.submitted_at),event:"Job submitted."}),e.start_at&&t.push({time:new Date(1e3*e.start_at),event:"Job started."}),e.end_at&&("CANCELLING"==e.status||"CANCELLED"==e.status?t.push({time:new Date(1e3*e.end_at),event:"Job cancelled."}):t.push({time:new Date(1e3*e.end_at),event:"Job completed."})),e.last_recovered_at&&e.last_recovered_at!=e.start_at&&t.push({time:new Date(1e3*e.last_recovered_at),event:"Job recovered."});let r=(e.end_at?e.end_at:Date.now()/1e3)-e.submitted_at,s=e.cloud,n=e.cluster_resources;if(!s){if(e.cluster_resources&&"-"!==e.cluster_resources)try{s=e.cluster_resources.split("(")[0].split("x").pop().trim(),n=e.cluster_resources.replace("".concat(s,"("),"(").replace("x ","x")}catch(e){s="Unknown"}else s="Unknown"}let a="",o=a=e.zone?e.zone:e.region;a&&a.length>15&&(a=a.substring(0,15)+"...");let c=s+" ("+a+")";"-"===a&&(c=s);let l=s+" ("+o+")";return"-"===o&&(l=s),{id:e.job_id,task:e.task_name,name:e.job_name,job_duration:e.job_duration,total_duration:r,workspace:e.workspace,status:e.status,requested_resources:e.resources,resources_str:n,resources_str_full:e.cluster_resources_full||n,cloud:s,infra:c,full_infra:l,recoveries:e.recovery_count,details:e.failure_reason,user:e.user_name,user_hash:e.user_hash,submitted_at:e.submitted_at?new Date(1e3*e.submitted_at):null,events:t}}),controllerStopped:!1}}catch(e){return console.error("Error fetching managed job data:",e),{jobs:[],controllerStopped:!1}}}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,[t,r]=(0,s.useState)(null),[n,a]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async function(){try{a(!0);let e=await o({allUsers:!0});r(e)}catch(e){console.error("Error fetching managed job data:",e)}finally{a(!1)}})()},[e]),{jobData:t,loading:n}}async function l(e){let{jobId:t,controller:r=!1,signal:s,onNewLog:o}=e,c=new Promise(e=>{setTimeout(()=>{e({timeout:!0})},1e4)}),l=(async()=>{try{let e=(await fetch("".concat(a.f4,"/jobs/logs"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({controller:r,follow:!1,job_id:t}),...s?{signal:s}:{}})).body.getReader();try{for(;;){let{done:t,value:r}=await e.read();if(t)break;let s=new TextDecoder().decode(r);o(s)}}finally{e.cancel()}return{timeout:!1}}catch(e){if("AbortError"===e.name)return{timeout:!1};throw e}})();if((await Promise.race([l,c])).timeout){(0,n.C)("Log request for job ".concat(t," timed out after ").concat(1e4,"ms"),"error");return}}async function i(e,t,r){let s="",o="",c="",l={};if("restartcontroller"===e)s="Restarting",o="restarted",c="jobs/queue",l={all_users:!0,refresh:!0},t="controller";else throw Error("Invalid action: ".concat(e));(0,n.C)("".concat(s," job ").concat(t,"..."),"info");try{try{let e=(await fetch("".concat(a.f4,"/").concat(c),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).headers.get("X-Skypilot-Request-ID"),i=await fetch("".concat(a.f4,"/api/get?request_id=").concat(e));if(200===i.status)(0,n.C)("Job ".concat(t," ").concat(o," successfully."),"success");else if(500===i.status)try{let e=await i.json();if(e.detail&&e.detail.error)try{let o=JSON.parse(e.detail.error);o.type&&o.type===a.Bo?(0,n.C)("".concat(s," job ").concat(t," is not supported!"),"error",1e4):o.type&&o.type===a.mF?(0,n.C)("Cluster ".concat(r," does not exist."),"error"):o.type&&o.type===a.iW?(0,n.C)("Cluster ".concat(r," is not up."),"error"):(0,n.C)("".concat(s," job ").concat(t," failed: ").concat(o.type),"error")}catch(r){(0,n.C)("".concat(s," job ").concat(t," failed: ").concat(e.detail.error),"error")}else(0,n.C)("".concat(s," job ").concat(t," failed with no details."),"error")}catch(e){(0,n.C)("".concat(s," job ").concat(t," failed with parse error."),"error")}else(0,n.C)("".concat(s," job ").concat(t," failed with status ").concat(i.status,"."),"error")}catch(e){console.error("Fetch error:",e),(0,n.C)("Network error ".concat(s," job ").concat(t,": ").concat(e.message),"error")}}catch(e){console.error("Error in handleStop:",e),(0,n.C)("Critical error ".concat(s," job ").concat(t,": ").concat(e.message),"error")}}},4545:function(e,t,r){"use strict";function s(e){return e.startsWith("sky-jobs-controller-")}function n(e,t,r){return null===t?e:[...e].sort((e,s)=>e[t]<s[t]?"ascending"===r?-1:1:e[t]>s[t]?"ascending"===r?1:-1:0)}r.d(t,{R0:function(){return n},Ym:function(){return s}})},7823:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return C}});var s=r(5893),n=r(7294),a=r(9008),o=r.n(a),c=r(8799),l=r(1664),i=r.n(l),u=r(803),d=r(8764),f=r(3225);async function m(){try{let e=await fetch("".concat(f.f4,"/users"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return(await e.json()).map(e=>({userId:e.id,username:e.name}))||[]}catch(e){return console.error("Failed to fetch users:",e),[]}}var p=r(3266),h=r(8969),b=r(4545),y=r(3626),g=r(9470),x=r(3001),j=r(7673);let _=e=>e&&e.includes("@")?e.split("@")[0]:e||"N/A",w=e=>e&&e.includes("@")?e:"-";function N(){let[e,t]=(0,n.useState)(!1),r=(0,n.useRef)(null),a=(0,x.X)();return(0,s.jsxs)(g.A,{highlighted:"users",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4 h-5",children:[(0,s.jsx)("div",{className:"text-base",children:(0,s.jsx)(i(),{href:"/users",className:"text-sky-blue hover:underline leading-none",children:"Users"})}),(0,s.jsxs)("div",{className:"flex items-center",children:[e&&(0,s.jsxs)("div",{className:"flex items-center mr-2",children:[(0,s.jsx)(c.Z,{size:15,className:"mt-0"}),(0,s.jsx)("span",{className:"ml-2 text-gray-500 text-sm",children:"Loading..."})]}),(0,s.jsxs)(u.z,{variant:"ghost",onClick:()=>{r.current&&r.current()},disabled:e,className:"text-sky-blue hover:text-sky-blue-bright flex items-center px-3 py-1.5 text-sm",children:[(0,s.jsx)(y.Z,{className:"h-4 w-4 mr-1.5"}),!a&&(0,s.jsx)("span",{children:"Refresh"})]})]})]}),(0,s.jsx)(v,{refreshInterval:3e4,setLoading:t,refreshDataRef:r})]})}function v(e){let{refreshInterval:t,setLoading:r,refreshDataRef:a}=e,[o,l]=(0,n.useState)([]),[i,u]=(0,n.useState)(!0),[f,y]=(0,n.useState)({key:"username",direction:"ascending"}),g=(0,n.useCallback)(async()=>{r&&r(!0),u(!0);try{let[e,t,r]=await Promise.all([m(),(0,p.zd)(),(0,h.Vp)()]),s=r.jobs||[],n=(e||[]).map(e=>{let r=(t||[]).filter(t=>t.user_hash===e.userId),n=(s||[]).filter(t=>t.user_hash===e.userId);return{...e,usernameDisplay:_(e.username),fullEmail:w(e.username),clusterCount:r.length,jobCount:n.length}});l(n)}catch(e){console.error("Failed to fetch or process user data:",e),l([])}r&&r(!1),u(!1)},[r]);(0,n.useEffect)(()=>{a&&(a.current=g)},[a,g]),(0,n.useEffect)(()=>{g();let e=setInterval(g,t);return()=>clearInterval(e)},[g,t]);let x=(0,n.useMemo)(()=>(0,b.R0)(o,f.key,f.direction),[o,f]),N=e=>{let t="ascending";f.key===e&&"ascending"===f.direction&&(t="descending"),y({key:e,direction:t})},v=e=>f.key===e?"ascending"===f.direction?" ↑":" ↓":"";return i&&0===o.length?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)(c.Z,{})}):x&&0!==x.length?(0,s.jsx)(j.Zb,{children:(0,s.jsxs)(d.iA,{children:[(0,s.jsx)(d.xD,{children:(0,s.jsxs)(d.SC,{children:[(0,s.jsxs)(d.ss,{onClick:()=>N("usernameDisplay"),className:"sortable whitespace-nowrap cursor-pointer hover:bg-gray-50 w-1/4",children:["Name",v("usernameDisplay")]}),(0,s.jsxs)(d.ss,{onClick:()=>N("fullEmail"),className:"sortable whitespace-nowrap cursor-pointer hover:bg-gray-50 w-1/4",children:["Email",v("fullEmail")]}),(0,s.jsxs)(d.ss,{onClick:()=>N("clusterCount"),className:"sortable whitespace-nowrap cursor-pointer hover:bg-gray-50 w-1/4",children:["Clusters",v("clusterCount")]}),(0,s.jsxs)(d.ss,{onClick:()=>N("jobCount"),className:"sortable whitespace-nowrap cursor-pointer hover:bg-gray-50 w-1/4",children:["Jobs",v("jobCount")]})]})}),(0,s.jsx)(d.RM,{children:x.map(e=>(0,s.jsxs)(d.SC,{children:[(0,s.jsx)(d.pj,{className:"truncate",title:e.username,children:e.usernameDisplay}),(0,s.jsx)(d.pj,{className:"truncate",title:e.fullEmail,children:e.fullEmail}),(0,s.jsx)(d.pj,{children:e.clusterCount>0?(0,s.jsx)("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:e.clusterCount}):(0,s.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-500 rounded text-xs font-medium",children:"0"})}),(0,s.jsx)(d.pj,{children:e.jobCount>0?(0,s.jsx)("span",{className:"px-2 py-0.5 bg-green-100 text-green-800 rounded text-xs font-medium",children:e.jobCount}):(0,s.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-500 rounded text-xs font-medium",children:"0"})})]},e.userId))})]})}):(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-lg font-semibold text-gray-500",children:"No users found."}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"There are currently no users to display."})]})}function C(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o(),{children:(0,s.jsx)("title",{children:"Users | SkyPilot Dashboard"})}),(0,s.jsx)(N,{})]})}},9008:function(e,t,r){e.exports=r(7219)},2003:function(e,t,r){"use strict";r.d(t,{j:function(){return o}});var s=r(512);let n=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=s.W,o=(e,t)=>r=>{var s;if((null==t?void 0:t.variants)==null)return a(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:o,defaultVariants:c}=t,l=Object.keys(o).map(e=>{let t=null==r?void 0:r[e],s=null==c?void 0:c[e];if(null===t)return null;let a=n(t)||n(s);return o[e][a]}),i=r&&Object.entries(r).reduce((e,t)=>{let[r,s]=t;return void 0===s||(e[r]=s),e},{});return a(e,l,null==t?void 0:null===(s=t.compoundVariants)||void 0===s?void 0:s.reduce((e,t)=>{let{class:r,className:s,...n}=t;return Object.entries(n).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...c,...i}[t]):({...c,...i})[t]===r})?[...e,r,s]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[573,480,888,774,179],function(){return e(e.s=7476)}),_N_E=e.O()}]);