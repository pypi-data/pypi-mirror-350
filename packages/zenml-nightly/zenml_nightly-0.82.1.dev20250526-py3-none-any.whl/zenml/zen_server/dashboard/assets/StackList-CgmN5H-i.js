import{r as l,j as e}from"./@radix-C7hRs6Kx.js";import{S as I}from"./plus-COjQg3AG.js";import{S as z}from"./refresh-CM5T3QeU.js";import{S as O,P as R}from"./SearchField-D-h6jXyg.js";import{s as g}from"./index-CrhdX_qG.js";import{z as h,ak as F,al as L,am as M,ai as U,aj as _,h as m,aQ as B,a2 as H,a3 as q,a4 as Q,S as p,A as D,b as A,J as j,B as $,Z as W,r as f,ac as G,o as J,F as K,p as Z,f as V,i as X,as as Y,at as ee,au as se,av as te,D as b,w as ae,x as ne,aH as re,M as ie}from"./index-D2iSHVZq.js";import{a as v,b as le,c as ce}from"./@tanstack-CSxjHCME.js";import{d as oe,L as N,c as de}from"./@react-router-CNP6g_RL.js";import{D as xe}from"./DisplayDate-CYVBBSgr.js";import{I as me}from"./InlineAvatar-Cfz4WSLK.js";import{C as w}from"./CodeSnippet-CvI6D0wx.js";import{S as ue,C as he}from"./CollapsibleCard-D20FtrzC.js";import{e as k}from"./components-Br2ezRib.js";import{N as C}from"./NumberBox-D2A7ENHb.js";import{C as pe}from"./ComponentBadge-DKw7Gndh.js";import{I as je}from"./Infobox-D9k5TFH4.js";import{S as fe}from"./dots-horizontal-BGRJCPCs.js";import{S as ge}from"./trash-BWSZ7NRK.js";import{D as ye}from"./DialogItem-BHWf3sIB.js";import{A as Ne}from"./AlertDialogDropdownItem-BG7-Ki1L.js";const y=1,we=h.object({page:h.coerce.number().min(y).optional().default(y).catch(y),name:h.string().optional(),operator:h.enum(["and","or"]).optional()});function ve(){const[t]=oe(),{page:s,name:a,operator:n}=we.parse({page:t.get("page")||void 0,name:t.get("name")||void 0});return{page:s,name:a,logical_operator:n}}const T=l.createContext(null);function Se({children:t}){const[s,a]=l.useState([]);return e.jsx(T.Provider,{value:{integrations:s,setIntegrations:a},children:t})}function P(){const t=l.useContext(T);if(t===null)throw new Error("useIntegrationsContext must be used within an AuthProvider");return t}const S=l.forwardRef(({closeModal:t,name:s,...a},n)=>e.jsxs(F,{...a,ref:n,children:[e.jsx(L,{children:e.jsx(M,{children:"Update Stack"})}),e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(be,{action:"update"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Update a stack"}),e.jsx(w,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack update ${s} -o NEW_ORCHESTRATOR_NAME`})]})]})]}));S.displayName="UpdateStackDialog";function be({action:t}){function s(){switch(t){case"delete":return"delete";case"update":return"update";case"describe":return"get details of"}}return e.jsx(je,{children:e.jsx("div",{className:"flex w-full flex-wrap justify-between gap-2",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-text-sm font-semibold",children:"We are working on the new Stacks experience."}),e.jsxs("p",{className:"truncate text-text-sm",children:["Meanwhile you can use the CLI to ",s()," your stack."]})]})})})}function ke({name:t}){const[s,a]=l.useState(!1);return e.jsxs(U,{open:s,onOpenChange:a,children:[e.jsx(_,{asChild:!0,children:e.jsx(m,{type:"button",size:"sm",intent:"primary",emphasis:"subtle",children:e.jsx(B,{})})}),e.jsx(S,{name:t,className:"lg:min-w-[600px]"})]})}function Ce({children:t,stackId:s,stackName:a}){return e.jsxs(H,{children:[e.jsx(q,{children:t}),e.jsx(Q,{className:"w-[1000px] overflow-y-auto",children:e.jsxs(Se,{children:[e.jsx(ue,{}),e.jsx(De,{stackId:s}),e.jsx(Pe,{name:a}),e.jsx(Ae,{stackId:s})]})})]})}function De({stackId:t}){const s=v({...g.stackDetail(t)});return s.isError?null:s.isPending?e.jsx("div",{className:"p-5",children:e.jsx(p,{className:"h-6 w-full"})}):e.jsxs("div",{className:"flex items-center justify-between border-b border-theme-border-moderate bg-theme-surface-primary p-5",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{type:"square",size:"lg",children:e.jsx(A,{size:"lg",children:s.data.name[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"mb-0.5 text-text-sm text-theme-text-secondary",children:s.data.id}),e.jsx(j,{copyText:s.data.id})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h2",{className:"text-display-xs font-semibold",children:s.data.name})})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ke,{name:s.data.name})})]})}function Ae({stackId:t}){var r;const{setIntegrations:s}=P(),a=v({...g.stackDetail(t)});if(l.useEffect(()=>{var d;if(!a.data)return;const c=k((d=a.data.metadata)==null?void 0:d.components).map(o=>{var x;return(x=o.body)==null?void 0:x.integration}).filter(o=>!!o&&o!=="built-in"&&o!=="custom");c.length>=1&&s(o=>Array.from(new Set([...o,...c])))},[a.data]),a.isError)return null;if(a.isPending)return e.jsx("div",{className:"p-5",children:e.jsx(p,{className:"h-[300px] w-full"})});const n=k((r=a.data.metadata)==null?void 0:r.components);return e.jsx("ul",{className:"space-y-5 p-5",children:n.map(i=>e.jsx("li",{children:e.jsx(Te,{component:i})},i.id))})}function Te({component:t}){var s,a,n,r;return e.jsxs($,{className:"flex items-center justify-between p-5",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{width:32,height:32,alt:`${(s=t.body)==null?void 0:s.flavor_name} logo`,src:W(((a=t.body)==null?void 0:a.logo_url)||"")}),e.jsxs("div",{children:[e.jsx(N,{to:f.components.detail(t.id),className:"text-text-xl",children:t.name}),e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:t.id.split("-")[0]}),e.jsx(j,{copyText:t.id})]})]})]}),e.jsx(N,{to:f.components.overview,children:e.jsx(pe,{type:((n=t.body)==null?void 0:n.type)||"orchestrator",children:G(((r=t.body)==null?void 0:r.type)||"")})})]})}function Pe({name:t}){const{integrations:s}=P();return e.jsx("section",{className:"px-5 pt-5",children:e.jsx(he,{title:e.jsx("span",{className:"text-text-lg",children:"Set this stack"}),initialOpen:!0,children:e.jsxs("ul",{className:"space-y-5",children:[e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{children:"1"}),e.jsx("p",{className:"font-semibold",children:"Set your stack"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Set the stack as active on your client"}),e.jsx(w,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack set ${t}`})]})]}),s.length>=1&&e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{children:"2"}),e.jsx("p",{className:"font-semibold",children:"Install the integrations"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Install the required integrations to run pipelines in your stack"}),e.jsx(w,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml integration install ${s.join(" ")}`})]})]})]})})})}async function Ee({stackId:t},s){const a=J(Z.stacks.detail(t)),n=await fetch(a,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const r=await n.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>`Error while deleting stack ${t}`);throw new K({status:n.status,statusText:n.statusText,message:r})}return n.json()}function Ie(t){return le({...t,mutationFn:async({stackId:s})=>Ee({stackId:s})})}function ze(t){const{toast:s}=V(),a=ce(),n=de(),r=Ie({onSuccess:async()=>{a.invalidateQueries({queryKey:g.all}),n(f.stacks.overview)},onError:c=>{s({status:"error",emphasis:"subtle",icon:e.jsx(X,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:c.message,rounded:!0})}});function i(){r.mutate({stackId:t})}return{handleDelete:i,deleteStack:r}}const E=l.forwardRef(({closeModal:t,name:s,stackId:a,...n},r)=>{const{handleDelete:i,deleteStack:c}=ze(a);return e.jsxs(Y,{...n,className:"p-0",ref:r,children:[e.jsxs(ee,{className:"m-0 py-2 pl-5 pr-3 text-text-lg font-semibold",children:["Delete ",s]}),e.jsx("div",{className:"border-y border-theme-border-moderate px-5 py-5",children:e.jsxs(se,{children:["Are you sure you want to delete this stack? ",e.jsx("br",{}),"This action cannot be undone."]})}),e.jsxs("div",{className:"flex justify-end gap-3 px-5 py-3",children:[e.jsx(te,{onClick:()=>t==null?void 0:t(),asChild:!0,children:e.jsx(m,{intent:"secondary",children:"Cancel"})}),e.jsxs(m,{disabled:c.isPending,type:"button",onClick:()=>i(),intent:"danger",children:[c.isPending&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-error"}),"Delete"]})]})]})});E.displayName="DeleteStackDialog";function Oe({name:t,id:s}){const[a,n]=l.useState(!1),[r,i]=l.useState(!1),c=l.useRef(null),d=l.useRef(null);function o(){d.current=c.current}function x(u){n(u),u===!1&&i(!1)}return e.jsx(b,{open:r,onOpenChange:i,children:e.jsxs(b,{children:[e.jsx(ae,{className:"z-10",ref:c,children:e.jsx(fe,{className:"h-5 w-5 fill-theme-text-secondary"})}),e.jsxs(ne,{hidden:a,onCloseAutoFocus:u=>{d.current&&(d.current.focus(),d.current=null,u.preventDefault())},className:"z-10",align:"end",sideOffset:1,children:[e.jsx(ye,{onSelect:o,onOpenChange:x,icon:e.jsx(re,{className:"h-3 w-3 !fill-neutral-400"}),triggerChildren:"Update",children:e.jsx(S,{name:t,className:"lg:min-w-[600px]",closeModal:()=>x(!1)})}),e.jsx(Ne,{onSelect:o,onOpenChange:x,icon:e.jsx(ge,{className:"h-3  w-3 !fill-neutral-400"}),triggerChildren:"Delete",children:e.jsx(E,{stackId:s,name:t,className:"lg:min-w-[600px]",closeModal:()=>x(!1)})})]})]})})}function Re(){const t=[{id:"name",header:"Stack",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{name:a,id:n}=s();return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(D,{type:"square",size:"md",children:e.jsx(A,{size:"md",children:a[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ce,{stackName:a,stackId:n,children:e.jsx("h2",{className:"text-text-md font-semibold",children:a})}),e.jsx(j,{copyText:a})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:n.split("-")[0]}),e.jsx(j,{copyText:n})]})]})]})}},{id:"created",header:"Created at",accessorFn:s=>{var a;return(a=s.body)==null?void 0:a.created},cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(xe,{dateString:s()})})},{id:"author",header:"Author",accessorFn:s=>{var a,n;return{author:(n=(a=s.body)==null?void 0:a.user)==null?void 0:n.name}},cell:({getValue:s})=>{const{author:a}=s();return a?e.jsx(me,{username:a}):null}},{id:"actions",header:"",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{id:a,name:n}=s();return e.jsx(Oe,{name:n,id:a})}}];return l.useMemo(()=>t,[])}function ts({fixedQueryParams:t={}}){const s=ve(),a=Re(),{refetch:n,data:r}=v({...g.stackList({...s,sort_by:"desc:updated",...t}),throwOnError:!0});return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx(O,{searchParams:s}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(m,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>n(),children:[e.jsx(z,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),e.jsx(m,{size:"md",asChild:!0,children:e.jsxs(N,{to:f.stacks.create.index,children:[e.jsx(I,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Stack"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:r?e.jsx(ie,{columns:a,data:r.items}):e.jsx(p,{className:"h-[500px] w-full"})}),r?r.total_pages>1&&e.jsx(R,{searchParams:s,paginate:r}):e.jsx(p,{className:"h-[36px] w-[300px]"})]})]})})}export{ts as S};
