import{j as e,r as k}from"./@radix-C7hRs6Kx.js";import{j as I,o as q,F as Q,p as L,ai as X,ak as G,al as W,am as H,S as B,aX as ee,aY as se,ae as re,aZ as te,a_ as ae,a$ as ne,I as $,b0 as oe,b1 as ie,b2 as A,b3 as N,m as le,b4 as ce,B as me,Z as de,h as v,W as ue,z as C,l as pe,f as xe,ah as he,X as fe}from"./index-D2iSHVZq.js";import{b as M,h as je,a as O,c as ge}from"./@tanstack-CSxjHCME.js";import{s as ye,g as Ne,a as ve,D as Ce,b as be,f as we}from"./index-CmLcvK2z.js";import{w as Se}from"./index-CFESYpe4.js";import{t as Fe}from"./zod-C0xYeTvL.js";import{b as Pe,C as ze,u as _e,F as Te}from"./index.esm-D7jFlf5N.js";import{b as Ee,C as ke}from"./ComponentIcon-ils7uNAk.js";import{S as Ae}from"./check-DK77doTf.js";import{S as Oe}from"./plus-COjQg3AG.js";import{C as De}from"./CodeSnippet-CvI6D0wx.js";import{S as Ie}from"./file-text-BdxZdjP_.js";import{S as qe}from"./terminal-square-DMtel8mb.js";async function Qe({payload:s,workspaceId:t}){const a=q(L.workspaces.components(t)),n=await I(a,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(s)});if(!n.ok){const u=await n.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>"Error while creating new stack");throw new Q({status:n.status,statusText:n.statusText,message:u})}return n.json()}function Le(s){return M({...s,mutationFn:async({workspaceId:t,payload:a})=>Qe({workspaceId:t,payload:a})})}function Be({open:s,setOpen:t}){return e.jsx(X,{open:s,onOpenChange:t,children:e.jsxs(G,{className:"max-w-[600px]",children:[e.jsx(W,{children:e.jsx(H,{children:"Create Service Connector"})}),e.jsx("div",{className:"min-w-0 p-5",children:e.jsxs("div",{className:"min-w-0 max-w-full space-y-1",children:[e.jsx("p",{children:"Create a new service connector"}),e.jsx(De,{wrap:!0,code:"zenml service-connector register <NAME> --type=<TYPE> --interactive"})]})})]})})}function $e({connectorResourceType:s}){var h;const t=Pe(),[a,n]=k.useState(!1),[u,i]=k.useState(!1),p=je(ye.serviceConnectorListInfinite({resource_type:s,sort_by:"desc:created"}));if(p.isPending)return e.jsx(B,{className:"h-[60px] w-full"});if(p.isError)return e.jsx("div",{children:"Error"});const c=(h=p.data)==null?void 0:h.pages.flatMap(m=>m.items);return e.jsxs(e.Fragment,{children:[e.jsx(ze,{control:t.control,name:"connector",render:({field:m})=>e.jsxs(ee,{modal:!0,open:a,onOpenChange:n,children:[e.jsx(se,{asChild:!0,children:e.jsx("button",{className:re("w-full flex-1 truncate rounded-md border border-primary-400 bg-theme-surface-secondary px-2",{"h-7":!m.value,"py-2 pl-2 pr-3 text-left":m.value}),children:m.value?(()=>{const r=c.find(d=>d.id===m.value);return r?e.jsx(D,{connector:r}):"Select Connector"})():"Select Connector"})}),e.jsx(te,{className:"p-0",style:{width:"var(--radix-popover-trigger-width)"},align:"start",children:e.jsxs(ae,{filter:(r,d)=>r.toLowerCase().includes(d.toLowerCase())||r.includes("doNotFilter-")?1:0,children:[c.length>0&&e.jsx(ne,{placeholder:"Search connectors...",children:e.jsx($,{className:"w-full",inputSize:"sm"})}),e.jsx(oe,{className:"space-y-1 p-2",children:e.jsxs("div",{className:"space-y-1",children:[c.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:"No results"}),e.jsx(A,{className:"max-h-[300px] overflow-y-auto",children:c.map(r=>e.jsxs(N,{value:`${r.id}:${r.name}`,onSelect:d=>{const[f]=d.split(":");t.setValue("connector",m.value===f?"":f),n(!1)},children:[e.jsx(D,{connector:r}),e.jsx(Ae,{className:le("fill-brand-500 ml-auto size-4 shrink-0",m.value===r.id?"opacity-100":"opacity-0")})]},r.id))})]}):e.jsx("div",{className:"p-2 text-center text-theme-text-secondary",children:"No connectors found"}),e.jsx(ce,{className:"-mx-1"}),e.jsxs(A,{children:[p.hasNextPage&&e.jsx(N,{value:"doNotFilter-fetch-more",className:"flex items-center font-semibold",onSelect:()=>{p.fetchNextPage()},children:"Load more"}),e.jsxs(N,{value:"doNotFilter-create-new",className:"flex items-center gap-2 font-semibold",onSelect:()=>{n(!1),i(!0)},children:[e.jsx(Oe,{className:"size-3 shrink-0 fill-neutral-400"}),"Create new Service Connector"]})]})]})})]})})]})}),e.jsx(Be,{open:u,setOpen:i})]})}function D({connector:s}){var t,a;return e.jsxs("div",{className:"flex items-center gap-2",children:[typeof((t=s.body)==null?void 0:t.connector_type)=="object"&&((a=s.body)==null?void 0:a.connector_type.logo_url)&&e.jsx("img",{src:s.body.connector_type.logo_url,alt:s.name,className:"size-5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-theme-text-secondary",children:s.id.split("-")[0]})]})]})}function Me({connectorResourceType:s}){return e.jsxs("section",{className:"w-full max-w-full space-y-3 overflow-x-hidden rounded-md border border-warning-50 bg-[#FFF6EA] p-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"size-5 shrink-0 fill-warning-400"}),e.jsx("p",{className:"text-text-lg font-semibold",children:"Connect to resource"})]}),e.jsx("p",{className:"text-theme-text-secondary",children:"You can select a Service Connector to connect ZenML to external resources"})]}),e.jsx($e,{connectorResourceType:s})]})}function Re({sdkDocsUrl:s,name:t,logoUrl:a,type:n}){return e.jsxs(me,{className:"space-y-5 overflow-hidden pb-5",children:[e.jsx("div",{className:"flex h-[120px] w-full items-center justify-center bg-teal-25",children:a?e.jsx("img",{width:60,height:60,className:"aspect-square object-contain",src:de(a),alt:`Logo of ${t}`}):e.jsx(ke,{className:"aspect-square h-[60px] w-[60px] fill-primary-400 object-contain",type:n})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"px-5",children:[e.jsx("p",{className:"text-text-lg font-semibold",children:"Need Help?"}),e.jsx("p",{className:"text-theme-text-secondary",children:"Follow our extensive documentation to get started."})]}),e.jsxs("ul",{className:"space-y-0.5 px-5",children:[!!s&&e.jsx("li",{children:e.jsx(v,{asChild:!0,emphasis:"minimal",intent:"primary",size:"md",children:e.jsxs("a",{className:"flex items-center gap-1",target:"_blank",rel:"noopener noreferrer",href:s,children:[e.jsx(Ie,{className:"size-5 shrink-0 fill-primary-600"}),"Api Reference"]})})}),e.jsx("li",{children:e.jsx(v,{asChild:!0,emphasis:"minimal",intent:"primary",size:"md",children:e.jsxs("a",{className:"flex items-center gap-1",target:"_blank",rel:"noopener noreferrer",href:"https://github.com/zenml-io/zenml/tree/main/examples",children:[e.jsx(qe,{className:"size-5 shrink-0 fill-primary-600"}),"Navigate our examples"]})})}),e.jsx("li",{children:e.jsx(v,{asChild:!0,emphasis:"minimal",intent:"primary",size:"md",children:e.jsxs("a",{className:"flex items-center gap-1",target:"_blank",rel:"noopener noreferrer",href:"https://www.zenml.io/blog",children:[e.jsx(ue,{className:"size-5 shrink-0 fill-primary-600"}),"Read our blog"]})})})]})]})]})}const Ue=C.object({componentName:C.string().min(1,"Component name is required"),connector:C.string()});async function Ve({componentId:s,payload:t}){const a=q(L.components.detail(s)),n=await I(a,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(t)});if(!n.ok){const u=await n.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>"Error while creating new stack");throw new Q({status:n.status,statusText:n.statusText,message:u})}return n.json()}function Ze(s){return M({...s,mutationFn:async({payload:t,componentId:a})=>Ve({payload:t,componentId:a})})}function is({flavorId:s,formId:t,successHandler:a,FooterComponent:n,useMaxHeight:u=!1,component:i,isCreate:p=!0}){var r,d,f,g;const c=O(we.flavorDetail(s)),h=pe(),m=O(Se.workspaceDetail("default"));return c.isPending||h.isPending||m.isPending?e.jsx("div",{className:"px-8 py-5",children:e.jsx(B,{className:"h-[250px] w-full"})}):c.isError||h.isError||m.isError?e.jsx("p",{className:"px-8 py-5",children:"Failed to fetch flavor"}):e.jsx(Ke,{isCreate:p,component:i,useMaxHeight:u,infoTile:e.jsx(Re,{type:((r=c.data.body)==null?void 0:r.type)||"orchestrator",name:c.data.name,sdkDocsUrl:((d=c.data.metadata)==null?void 0:d.sdk_docs_url)??void 0,logoUrl:((f=c.data.body)==null?void 0:f.logo_url)??void 0}),FooterComponent:n,successHandler:a,workspaceId:m.data.id,flavor:c.data,userId:h.data.id,formId:t,schema:(g=c.data.metadata)==null?void 0:g.config_schema})}function Ke({formId:s,schema:t,flavor:a,userId:n,workspaceId:u,successHandler:i,infoTile:p,FooterComponent:c,useMaxHeight:h,isCreate:m,component:r}){var S,F,P,z,_;const{toast:d}=xe(),f=fe.all,g=ge(),b=Le({onSuccess:({id:o})=>{g.invalidateQueries({queryKey:f}),i==null||i(o)},onError:o=>{d({emphasis:"subtle",status:"error",rounded:!0,description:o.message})}}),R=Ze({onSuccess:({id:o})=>{g.invalidateQueries({queryKey:f}),i==null||i(o)},onError:o=>{d({emphasis:"subtle",status:"error",rounded:!0,description:o.message})}}),U=t.properties||{},y=t.required||[],V=t.$defs;function Z({componentName:o,...l}){if(Object.keys(l).forEach(x=>{(l[x]===""||l[x]===null||l[x]===void 0||Array.isArray(l[x])&&l[x].length===0||typeof l[x]=="object"&&!Array.isArray(l[x])&&Object.keys(l[x]).length===0)&&delete l[x]}),!a.body)return;const{connector:T,...E}=l;if(m)b.mutate({workspaceId:u,payload:{name:o,configuration:E,flavor:a.name,type:a.body.type,user:n,connector:T||null,workspace:u}});else{if(!r)return;R.mutate({componentId:r.id,payload:{name:o,configuration:E,connector:T||null}})}}const K=Ue.merge(Ne(t)),Y=ve(t,(S=r==null?void 0:r.metadata)==null?void 0:S.configuration),j=_e({resolver:Fe(K),defaultValues:{componentName:(r==null?void 0:r.name)??"",connector:((P=(F=r==null?void 0:r.metadata)==null?void 0:F.connector)==null?void 0:P.id)??"",...Y}}),{handleSubmit:J}=j,w=Object.entries(U).sort(([o],[l])=>y.includes(o)&&!y.includes(l)?-1:!y.includes(o)&&y.includes(l)?1:0);return e.jsx(Te,{...j,children:e.jsxs("form",{onSubmit:o=>(o.stopPropagation(),J(Z)(o)),id:s,children:[e.jsx(he,{viewportClassName:h?"max-h-[70vh]":"",children:e.jsxs("div",{className:"space-y-4 p-8",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-text-lg font-semibold",children:"Component Name"}),e.jsx($,{...j.register("componentName"),"data-error":j.formState.errors.componentName?"true":"false",className:"w-full data-[error=true]:border-error-500",inputSize:"lg"}),j.formState.errors.componentName&&e.jsx("p",{className:"text-text-sm text-error-500",children:(z=j.formState.errors.componentName.message)==null?void 0:z.toString()})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-5 xl:flex-row",children:[e.jsxs("div",{className:"flex-1 space-y-5",children:[(_=a.metadata)!=null&&_.connector_resource_type?e.jsx(Me,{connectorResourceType:a.metadata.connector_resource_type}):null,w.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-text-lg font-semibold",children:"Attributes"}),w.map(([o,l])=>e.jsx(Ce,{definitions:V,isOptional:be(o,y),name:o,schema:l},o))]}):null]}),e.jsx("div",{className:"w-full xl:w-1/3",children:p})]})]})}),e.jsx(c,{formId:s,isPending:b.isPending})]})})}export{is as C};
