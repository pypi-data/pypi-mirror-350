"use strict";(self.webpackChunkjupyter_package_manager=self.webpackChunkjupyter_package_manager||[]).push([[7],{7:(e,a,n)=>{n.r(a),n.d(a,{default:()=>D});var t=n(345),s=n.n(t),r=n(235);const l=new r.LabIcon({name:"package-manager-icon",svgstr:'\n<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-package-export">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M12 21l-8 -4.5v-9l8 -4.5l8 4.5v4.5" />\n  <path d="M12 12l8 -4.5" />\n  <path d="M12 12v9" />\n  <path d="M12 12l-8 -4.5" />\n  <path d="M15 18h7" />\n  <path d="M19 15l3 3l-3 3" />\n</svg>\n'}),o=(0,t.createContext)(null);function i(){return(0,t.useContext)(o)}function c({children:e,notebookWatcher:a}){const[n,r]=(0,t.useState)(a.notebookPanel());return(0,t.useEffect)((()=>{const e=(e,a)=>{r(a)};return a.notebookPanelChanged.connect(e),r(a.notebookPanel()),()=>{a.notebookPanelChanged.disconnect(e)}}),[a]),s().createElement(o.Provider,{value:n},e)}const m=(0,t.createContext)(null);function d({children:e,notebookWatcher:a}){const[n,r]=(0,t.useState)(a.kernelInfo);return(0,t.useEffect)((()=>{const e=(e,a)=>{r(a)};return a.kernelChanged.connect(e),r(a.kernelInfo),()=>{a.kernelChanged.disconnect(e)}}),[a]),s().createElement(m.Provider,{value:n},e)}const h=(0,t.createContext)(void 0);let u={};const g=({children:e,stateDB:a,commands:n})=>{const r=i(),l=(0,t.useContext)(m),[o,c]=(0,t.useState)([]),[d,g]=(0,t.useState)(!1),[p,k]=(0,t.useState)(null),[v,_]=(0,t.useState)(""),f=e=>{c(e),a.save("mljarPackagesList",JSON.stringify(e))},b=e=>{g(e),a.save("mljarPackagesListLoading",e)},w=(0,t.useCallback)((async()=>{var e,a,n,t,s,o;if(f([]),b(!0),k(null),r&&l)try{const l=null===(n=null===(a=null===(e=r.sessionContext)||void 0===e?void 0:e.session)||void 0===a?void 0:a.kernel)||void 0===n?void 0:n.id;if(null!=l&&l in u)f(u[l]),b(!1);else{const e=null===(o=null===(s=null===(t=r.sessionContext)||void 0===t?void 0:t.session)||void 0===s?void 0:s.kernel)||void 0===o?void 0:o.requestExecute({code:'\ndef __mljar__list_packages():\n    from importlib.metadata import distributions\n    pkgs = []\n    seen = set()\n    for dist in distributions():\n        name = dist.metadata["Name"]\n        if name not in seen:\n            seen.add(name)\n            pkgs.append({"name": name, "version": dist.version})\n    return pkgs\n\n__mljar__list_packages()\n',store_history:!1});e&&(e.onIOPub=e=>{const a=e.header.msg_type;if("execute_result"===a||"display_data"===a||"update_display_data"===a){const a=e.content,n=a.data["application/json"],t=a.data["text/plain"];if(n)Array.isArray(n)?f(n):console.warn("Data is not JSON:",n),b(!1);else if(t)try{const e=t.replace(/^['"]|['"]$/g,"").replace(/'/g,'"'),a=JSON.parse(e);if(!Array.isArray(a))throw new Error("Error during parsing.");f([]),f(a),null!=l&&(u[l]=a),b(!1)}catch(e){console.error("Error during export JSON from text/plain:",e),k("Error during export JSON"),b(!1)}}})}}catch(e){console.error("Unexpected error:",e),k("Unexpected error"),b(!1)}else b(!1)}),[r,l]);return(0,t.useEffect)((()=>{w()}),[w]),(0,t.useEffect)((()=>{n.addCommand("mljar-packages-manager-refresh",{execute:()=>{u={},w()},label:"Refresh packages in MLJAR Packages Manager"})}),[n]),s().createElement(h.Provider,{value:{packages:o,loading:d,error:p,searchTerm:v,setSearchTerm:_,refreshPackages:()=>{u={},w()}}},e)},p=()=>{const e=(0,t.useContext)(h);if(void 0===e)throw new Error("usePackageContext must be used within a PackageProvider");return e},k=()=>{const{searchTerm:e,setSearchTerm:a}=p();return s().createElement("div",{className:"mljar-packages-manager-search-bar-container"},s().createElement("input",{type:"text",value:e,onChange:e=>{a(e.target.value)},placeholder:"Search Package...",className:"mljar-packages-manager-search-bar-input"}))},v=new r.LabIcon({name:"my-delete-icon",svgstr:'\n<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-trash"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7l16 0" /><path d="M10 11l0 6" /><path d="M14 11l0 6" /><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" /><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" /></svg>\n'}),_=new r.LabIcon({name:"my-error-icon",svgstr:'\n<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-zoom-exclamation"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" /><path d="M21 21l-6 -6" /><path d="M10 13v.01" /><path d="M10 7v3" /></svg>\n'}),f=({pkg:e})=>{const a=i(),{refreshPackages:n}=p(),[r,l]=(0,t.useState)(!1),[o,c]=(0,t.useState)(!1);return s().createElement("li",{className:"mljar-packages-manager-list-item"},s().createElement("span",{className:"mljar-packages-manager-package-name"}," ",e.name),s().createElement("span",{className:"mljar-packages-manager-package-version"},e.version),!r&&s().createElement("button",{className:"mljar-packages-manager-delete-button",onClick:async()=>{var t,s;let r=!1;if(r=window.electron?await window.electron.invoke("show-confirm-dialog",`Click "Ok" to confirm the deletion of ${e.name}.`):window.confirm(`Click "Ok" to confirm the deletion of ${e.name}.`),r){l(!0),c(!1);const r=(e=>`\ndef __mljar__remove_package():\n    import subprocess\n    import sys\n    python_exe = sys.executable\n    if python_exe.startswith('\\\\?'):\n        python_exe = python_exe[4:]\n    subprocess.check_call([python_exe, '-m', 'pip', 'uninstall', '-y', '${e}'])\n__mljar__remove_package()\n`)(e.name),o=null===(s=null===(t=null==a?void 0:a.sessionContext.session)||void 0===t?void 0:t.kernel)||void 0===s?void 0:s.requestExecute({code:r,store_history:!1});if(!o)return l(!1),void c(!0);o.onIOPub=e=>{const a=e.header.msg_type;if("stream"===a||"execute_result"===a||"display_data"===a||"update_display_data"===a){const a=e.content;a.text.includes("ERROR")?(c(!0),l(!1)):a.text.includes("Successfully uninstalled")&&(c(!1),c(!1),n())}else"error"===a&&(c(!0),l(!1))}}},"aria-label":o?`Error during uninstalling ${e.name}`:`Uninstall ${e.name}`,title:`Delete ${e.name}`},o?s().createElement(_.react,{className:"mljar-packages-manager-error-icon"}):s().createElement(v.react,{className:"mljar-packages-manager-delete-icon"})),r&&s().createElement("span",{className:"mljar-packages-manager-spinner"}))},b=()=>{const{packages:e,searchTerm:a}=p(),n=e.filter((e=>e.name.toLowerCase().includes(a.toLowerCase())));return 0===n.length?s().createElement("p",null,"Sorry, no packages found or notebook is closed."):s().createElement("ul",{className:"mljar-packages-manager-list"},s().createElement("li",{className:"mljar-packages-manager-list-header"},s().createElement("span",{className:"mljar-packages-manager-header-name"},"Name"),s().createElement("span",{className:"mljar-packages-manager-header-version"},"Version"),s().createElement("span",{className:"mljar-packages-manager-header-blank"},"Â ")),n.sort(((e,a)=>e.name.localeCompare(a.name))).map((e=>s().createElement(f,{key:e.name,pkg:e}))))},w=()=>{const{loading:e,error:a}=p();return s().createElement("div",{className:"mljar-packages-manager-list-container"},e&&s().createElement("div",{className:"mljar-packages-manager-spinner-container"},s().createElement("div",{className:"mljar-packages-manager-spinner",role:"status","aria-label":"Loading"})),a&&s().createElement("p",{className:"mljar-packages-manager-error-message"},a),!e&&!a&&s().createElement(b,null))},E=new r.LabIcon({name:"my-refresh-icon",svgstr:'\n<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-refresh"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4" /><path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4" /></svg>\n'}),x=()=>{const{refreshPackages:e,loading:a}=p();return s().createElement("button",{className:"mljar-packages-manager-refresh-button",onClick:e,disabled:a,title:"Refresh Packages"},s().createElement(E.react,{className:"mljar-packages-manager-refresh-icon"}))},C=new r.LabIcon({name:"my-install-icon",svgstr:'\n<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-cube-plus"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 12.5v-4.509a1.98 1.98 0 0 0 -1 -1.717l-7 -4.008a2.016 2.016 0 0 0 -2 0l-7 4.007c-.619 .355 -1 1.01 -1 1.718v8.018c0 .709 .381 1.363 1 1.717l7 4.008a2.016 2.016 0 0 0 2 0" /><path d="M12 22v-10" /><path d="M12 12l8.73 -5.04" /><path d="M3.27 6.96l8.73 5.04" /><path d="M16 19h6" /><path d="M19 16v6" /></svg>\n'}),y=({onStartInstall:e})=>{const{loading:a}=p();return s().createElement("button",{className:"mljar-packages-manager-install-button",onClick:e,disabled:a,title:"Install Package"},s().createElement(C.react,{className:"mljar-packages-manager-install-icon"}))},j=new r.LabIcon({name:"my-back-icon",svgstr:'\n<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-back-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 14l-4 -4l4 -4" /><path d="M5 10h11a4 4 0 1 1 0 8h-1" /></svg>\n'}),N=({onBack:e})=>s().createElement("button",{className:"mljar-packages-manager-back-button",onClick:e,title:"Go Back"},s().createElement(j.react,{className:"mljar-packages-manager-back-icon"}),"Back"),P=e=>(null==e?void 0:e.toLowerCase().includes("success"))||(null==e?void 0:e.toLowerCase().includes("already"))||!1,S=()=>{const[e,a]=(0,t.useState)(""),[n,r]=(0,t.useState)(!1),[l,o]=(0,t.useState)(null),c=i(),{refreshPackages:m}=p();return s().createElement("div",{className:"mljar-packages-manager-install-form"},s().createElement("span",{className:"mljar-packages-manager-usage-span"},s().createElement("span",{style:{fontWeight:600}},"Usage: "),"Enter"," ",s().createElement("span",{style:{fontWeight:600,color:"#0099cc"}},"package_name")," ","or"," ",s().createElement("span",{style:{fontWeight:600,color:"#0099cc"}},"package_name==version")),s().createElement("input",{type:"text",value:e,onChange:e=>a(e.target.value),placeholder:"Enter package name...",className:"mljar-packages-manager-install-input"}),s().createElement("div",{className:"mljar-packages-manager-install-form-buttons"},s().createElement("button",{className:"mljar-packages-manager-install-submit-button",onClick:()=>{var a,n;r(!0),o(null);const t=`\ndef __mljar__check_if_installed():\n    from importlib.metadata import distributions\n    for dist in distributions():\n        if dist.metadata["Name"].lower() == "${e}".lower():\n            print("INSTALLED")\n            return\n    print("NOT_INSTALLED")\n__mljar__check_if_installed()\n`,s=null===(n=null===(a=null==c?void 0:c.sessionContext.session)||void 0===a?void 0:a.kernel)||void 0===n?void 0:n.requestExecute({code:t,store_history:!1});if(!s)return r(!1),void o("No kernel available.");s.onIOPub=a=>{const n=a.header.msg_type;if("stream"===n||"execute_result"===n||"display_data"===n||"update_display_data"===n){const n=a.content;n.text.includes("NOT_INSTALLED")?(()=>{var a,n;const t=`\ndef __mljar__install_pip():\n    import subprocess\n    import sys\n    python_exe = sys.executable\n    if python_exe.startswith('\\\\?'):\n        python_exe = python_exe[4:] \n    subprocess.check_call([python_exe, '-m', 'pip', 'install', '${e}'])\n__mljar__install_pip()\n`,s=null===(n=null===(a=null==c?void 0:c.sessionContext.session)||void 0===a?void 0:a.kernel)||void 0===n?void 0:n.requestExecute({code:t,store_history:!1});if(!s)return o("No kernel available."),void r(!1);s.onIOPub=e=>{const a=e.header.msg_type;if("stream"===a||"execute_result"===a||"display_data"===a||"update_display_data"===a){const a=e.content;a.text.includes("ERROR")?(o("Error installing the package."),r(!1)):a.text.includes("Successfully installed")&&(o("Package installed successfully."),r(!1),m())}else"error"===a&&(o("An error occurred during installation. Check the correctness of the package name."),r(!1))}})():n.text.includes("INSTALLED")&&(r(!1),o("Package is already installed."))}else"error"===n&&(r(!1),o("An error occurred while checking installation. Check the correctness of the package name."))}},disabled:n||""===e.trim()},n?"Processing...":"Install")),l&&s().createElement("p",{className:"mljar-packages-manager-install-message "+(P(l)?"success":"error")},l))},M=()=>{const[e,a]=(0,t.useState)("list");return s().createElement("div",{className:"mljar-packages-manager-container"},s().createElement("div",{className:"mljar-packages-manager-header-container"},"list"===e&&s().createElement("h3",{className:"mljar-packages-manager-header"},"Packages Manager"),"install"===e&&s().createElement("h3",{className:"mljar-packages-manager-header"},"Install Packages"),"list"===e&&s().createElement(x,null),"list"===e&&s().createElement(y,{onStartInstall:()=>{a("install")}}),"install"===e&&s().createElement(N,{onBack:()=>{a("list")}})),"list"===e?s().createElement("div",null,s().createElement(k,null),s().createElement(w,null)):s().createElement(S,null))};class I extends r.ReactWidget{constructor(e,a,n){super(),this.notebookWatcher=e,this.stateDB=a,this.commands=n,this.id="package-manager::empty-sidebar",this.title.icon=l,this.title.caption="Package Manager",this.addClass("mljar-packages-manager-sidebar-widget")}render(){return s().createElement("div",{className:"mljar-packages-manager-sidebar-container"},s().createElement(c,{notebookWatcher:this.notebookWatcher},s().createElement(d,{notebookWatcher:this.notebookWatcher},s().createElement(g,{stateDB:this.stateDB,commands:this.commands},s().createElement(M,null)))))}}var L=n(801),A=n(263),B=n(602),O=n(178);class W{constructor(e){var a;this._kernelInfo=null,this._kernelChanged=new B.Signal(this),this._mainAreaWidget=null,this._selections=[],this._selectionChanged=new B.Signal(this),this._notebookPanel=null,this._notebookPanelChanged=new B.Signal(this),this._shell=e,null===(a=this._shell.currentChanged)||void 0===a||a.connect(((e,a)=>{this._mainAreaWidget=a.newValue,this._notebookPanel=this.notebookPanel(),this._notebookPanelChanged.emit(this._notebookPanel),this._attachKernelChangeHandler()}))}get selection(){return this._selections}get selectionChanged(){return this._selectionChanged}get notebookPanelChanged(){return this._notebookPanelChanged}get kernelInfo(){return this._kernelInfo}get kernelChanged(){return this._kernelChanged}notebookPanel(){const e=function(e){if(!(e instanceof O.DocumentWidget))return null;const{content:a}=e;return a instanceof A.Notebook?a:null}(this._mainAreaWidget);return e&&e.parent instanceof A.NotebookPanel?e.parent:null}_attachKernelChangeHandler(){if(this._notebookPanel){const e=this._notebookPanel.sessionContext.session;e?(e.kernelChanged.connect(this._onKernelChanged,this),this._updateKernelInfo(e.kernel)):setTimeout((()=>{var e;const a=null===(e=this._notebookPanel)||void 0===e?void 0:e.sessionContext.session;a?(a.kernelChanged.connect(this._onKernelChanged,this),this._updateKernelInfo(a.kernel)):console.warn("Session not initialized after delay")}),2e3)}else console.warn("Session not initalizated")}_onKernelChanged(e,a){a.newValue?this._updateKernelInfo(a.newValue):(this._kernelInfo=null,this._kernelChanged.emit(null))}_updateKernelInfo(e){this._kernelInfo={name:e.name,id:e.id},this._kernelChanged.emit(this._kernelInfo)}}const D={id:"mljar-package-manager:plugin",description:"A JupyterLab extension to list, remove and install python packages from pip.",autoStart:!0,requires:[L.IStateDB],activate:async(e,a)=>{const n=function(e,a,n){return new I(e,a,n)}(new W(e.shell),a,e.commands);e.shell.add(n,"left",{rank:1999})}}}}]);