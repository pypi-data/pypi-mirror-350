[tox]
requires = 
    tox>=4.19
env_list =
    py3{8-12}-{unit}
    py3{8-12}-sphinx{5-8}-{integration}
    lint
    format

[testenv]
deps = 
    .

[testenv:lint]
description = run type check on code base
labels = static
deps = 
    mypy
commands =
    python3 -m mypy src tests --junit-xml test-reports/{env_name}.xml

[testenv:audit]
description = run type check on code base
labels = audit
deps = 
    pip-audit
commands =
    pip-audit .

[testenv:format]
description = run type check on code base
labels = static
deps = 
    black
commands =
    black --check src tests

[testenv:py3{9-13}-unit]
description = run type check on code base
labels = unit
deps = 
    {[testenv]deps}
    pytest
commands =
    pytest tests/unit --junitxml=test-reports/{env_name}.xml

[testenv:py3{9-13}-sphinx{5-7}-integration]
description = run type check on code base
labels = integration
deps =
    {[testenv]deps}
    sphinx5: sphinx>=5.0,<=6.0
    sphinx6: sphinx>=6.0,<=7.0
    sphinx7: sphinx>=7.0,<=8.0
    pytest
commands =
    pytest tests/integration --junitxml=test-reports/{env_name}.xml

[testenv:py3{10-13}-sphinx8-integration]
description = run type check on code base
labels = integration
deps =
    {[testenv]deps}
    sphinx8: sphinx>=8.0,<=9.0
    pytest
commands =
    pytest tests/integration --junitxml=test-reports/{env_name}.xml
