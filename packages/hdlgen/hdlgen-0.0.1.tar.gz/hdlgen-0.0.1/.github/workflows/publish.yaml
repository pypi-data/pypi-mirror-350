name: Publish HDLGen master

on:
  push:
    branches:
      - master

jobs:
    build:
        name: Build distribution
        runs-on: ubuntu-latest

        steps:
        - uses: actions/checkout@v4
          with:
            fetch-depth: 0
            persist-credentials: false

        - name: Install uv
          uses: astral-sh/setup-uv@v5
        
        - name: building
          run: uv build

        - name: publish
          run: uv publish -t ${{ secrets.PYPI_TOKEN }}

        - name: TestPyPI
          run: uv run --with hdlgen --no-project -- python -c "import hdlgen"