#! Generated by VisualDCT v2.6
#! DBDSTART
#! DBD("../../dbd/dlsPLC_vdct.dbd")
#! DBDEND


# NX102_vacValveTcloseValve.template

#% macro, __doc__, Template database for a vacuum valve TCLOSE metrics, value from PLC is in 1/10 seconds hence ASLO = 0.1
#% macro, device, device name
#% macro, port, asyn port name of etherip driver
#% macro, tag, etherip tag
#% macro, tagidx, etherip tag indext
#% macro, tclose_high, HIGH alarm level for TCLOSE record (Optional - defaults to 0)
#% macro, tclose_hihi, HIHI alarm level for TCLOSE record (Optional - defaults to 0)
#% macro, tclose_hsv,  HSV  HIGH severity level for TCLOSE record (Optional - defaults to NO_ALARM)
#% macro, tclose_hhsv, HHSV HIHI severity level for TCLOSE record (Optional - defaults to NO_ALARM)



#
#% archiver 10 Monitor
#% controldesk Current Close Time readback
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py $(device):TCLOSE
#% alh $SEVRCOMMAND UP_ANY dls-sendsms-alarm.py $(device):TCLOSE
#
record(ai, "$(device):TCLOSE") {
  field(DESC, "Close Time")
  field(DTYP, "EtherIP")
  field(SCAN, "1 second")
  field(INP,  "@$(port) $(tag).Last_Close_Time[$(tagidx)]")
  field(EGU, "s")
  field(HOPR, "10")
  field(LOPR, "2")
  field(ASLO, "0.1")
  field(HIGH, "$(tclose_high=1.5)")
  field(HIHI, "$(tclose_hihi=3.0)")
  field(HSV, "$(tclose_hsv=MINOR)")
  field(HHSV, "$(tclose_hhsv=MAJOR)")
}

#% archiver 10 Monitor
record(ai, "$(device):TRESP") {
  field(DESC, "Time between command and action")
  field(DTYP, "EtherIP")
  field(SCAN, "1 second")
  field(INP, "@$(port) $(tag).Last_Close_Response[$(tagidx)]")
  field(EGU, "s")
  field(HOPR, "10")
  field(LOPR, "2")
  field(ASLO, "0.1")
  field(HIGH, "$(tclose_high=1.5)")
  field(HIHI, "$(tclose_hihi=3.0)")
  field(HSV, "$(tclose_hsv=MINOR)")
  field(HHSV, "$(tclose_hhsv=MAJOR)")
}

#% archiver 10 Monitor
record(ai, "$(device):ODUR") {
  field(DESC, "Open duration")
  field(DTYP, "EtherIP")
  field(SCAN, "1 second")
  field(INP, "@$(port) $(tag).Last_Open_Duration[$(tagidx)]")
  field(EGU, "s")
}

#% archiver 10 Monitor
record(ai, "$(device):CDUR") {
  field(DESC, "Close duration")
  field(DTYP, "EtherIP")
  field(SCAN, "1 second")
  field(INP, "@$(port) $(tag).Last_Close_Duration[$(tagidx)]")
  field(EGU, "s")
}
