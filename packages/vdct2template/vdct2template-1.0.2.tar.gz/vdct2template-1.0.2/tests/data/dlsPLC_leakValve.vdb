#! Generated by VisualDCT v2.6
#! DBDSTART
#! DBD("../../dbd/dlsPLC_vdct.dbd")
#! DBDEND


# leakValve.template
#% macro, __doc__, Template database for a vacuum leak valve without debounce or raw air records
#% macro, device, device name
#% macro, vlvcc, device name of valve control crate (prefix of device name), NOTE: make sure there is a read100 component whose century (0 means 0-99) includes the object address
#% macro, port, asyn port name of FINS driver
#% macro, addr, First address in the DM variable range decade. E.g. if valve is in DM110..119 then addr=110
#% macro, addr_decade, Decade of address in the DM variable range. E.g. if valve is in DM110 then addr_decade=11
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, ilk0, Interlock description 0
#% macro, ilk1, Interlock description 1
#% macro, ilk2, Interlock description 2
#% macro, ilk3, Interlock description 3
#% macro, ilk4, Interlock description 4
#% macro, ilk5, Interlock description 5
#% macro, ilk6, Interlock description 6
#% macro, ilk7, Interlock description 7
#% macro, ilk8, Interlock description 8
#% macro, ilk9, Interlock description 9
#% macro, ilk10, Interlock description 10
#% macro, ilk11, Interlock description 11
#% macro, ilk12, Interlock description 12
#% macro, ilk13, Interlock description 13
#% macro, ilk14, Interlock description 14
#% macro, ilk15, Interlock description 15
#% macro, gilk0, Gauge interlock description 0
#% macro, gilk1, Gauge interlock description 1
#% macro, gilk2, Gauge interlock description 2
#% macro, gilk3, Gauge interlock description 3
#% macro, gilk4, Gauge interlock description 4
#% macro, gilk5, Gauge interlock description 5
#% macro, gilk6, Gauge interlock description 6
#% macro, gilk7, Gauge interlock description 7
#% macro, gilk8, Gauge interlock description 8
#% macro, gilk9, Gauge interlock description 9
#% macro, gilk10, Gauge interlock description 10
#% macro, gilk11, Gauge interlock description 11
#% macro, gilk12, Gauge interlock description 12
#% macro, gilk13, Gauge interlock description 13
#% macro, gilk14, Gauge interlock description 14
#% macro, gilk15, Gauge interlock description 15
#% macro, con_label0, Label string for control value 0 (Optional - defaults to Open)
#% macro, con_label1, Label string for control value 1 (Optional - defaults to Close)
#% macro, con_label2, Label string for control value 2 (Optional - defaults to Reset)
#% macro, con_label3, Label string for control value 3 (Optional - defaults to "")
#% macro, con_label4, Label string for control value 4 (Optional - defaults to "")
#% macro, con_label5, Label string for control value 5 (Optional - defaults to "")
#% macro, con_label6, Label string for control value 6 (Optional - defaults to "")
#% macro, sta_label0, Label string for status value 0 (Optional - defaults to Fault)
#% macro, sta_label1, Label string for status value 1 (Optional - defaults to Open)
#% macro, sta_label2, Label string for status value 2 (Optional - defaults to Opening)
#% macro, sta_label3, Label string for status value 3 (Optional - defaults to Closed)
#% macro, sta_label4, Label string for status value 4 (Optional - defaults to Closing)
#% macro, sta_label5, Label string for status value 5 (Optional - defaults to "")
#% macro, sta_label6, Label string for status value 6 (Optional - defaults to "")
#% macro, sta_sv0, Optional. Defaults to MAJOR.     Alarm severity for status value 0.
#% macro, sta_sv1, Optional. Defaults to NO_ALARM.  Alarm severity for status value 1.
#% macro, sta_sv2, Optional. Defaults to NO_ALARM.  Alarm severity for status value 2.
#% macro, sta_sv3, Optional. Defaults to NO_ALARM.  Alarm severity for status value 3.
#% macro, sta_sv4, Optional. Defaults to NO_ALARM.  Alarm severity for status value 4.
#% macro, sta_sv5, Optional. Defaults to NO_ALARM.  Alarm severity for status value 5.
#% macro, sta_sv6, Optional. Defaults to NO_ALARM.  Alarm severity for status value 6.
#% macro, target_pressure, Target pressure (Optional - defaults to "2.0e-7")
#% macro, img, Current pressure IMG:P PV
#% macro, name, Object name and associated gui name
#% macro, gda_name, GDA name to export to gda as if it exists
#% macro, gda_desc, GDA description
#% macro, desc, Box label for gui
#% macro, mode1, name of remote operational mode (:MODE)
#% macro, mode2, name of local operational mode (:MODE)
#% macro, setpoint_max, Maximum pressure for target setpoint (Optional - defaults to 5.0e-7)
#% macro, EMPTY, Empty substitution to satisfy VDCT
# This associates an edm screen with the template
# % gui, $(name=), edm, vacuumValve.edl, device=$(device)
# % gui, $(name=), edmembed, vacuumValve-embed.edl, device=$(device),box-label=$(desc=$(device))

# This tells the gui that we don't have debounce records
record(ai, "$(device):HASDEBOUNCE") 
    {
    field(VAL, "0")
    field(PINI, "YES")
    }

expand("dlsPLC_valveCtrl.vdb", valveCtrl) {
  macro(con_label0, "$(con_label0=Operate)")
  macro(con_label1, "$(con_label1=Close)")
  macro(con_label2, "$(con_label2=Reset)")
  macro(con_label3, "$(con_label3=)")
  macro(con_label4, "$(con_label4=)")
  macro(con_label5, "$(con_label5=)")
  macro(con_label6, "$(con_label6=)")
  macro(sta_label0, "$(sta_label0=Fault)")
  macro(sta_label1, "$(sta_label1=Operating)")
  macro(sta_label2, "$(sta_label2=Changing)")
  macro(sta_label3, "$(sta_label3=Closed)")
  macro(sta_label4, "$(sta_label4=)")
  macro(sta_label5, "$(sta_label5=)")
  macro(sta_label6, "$(sta_label6=)")
  macro(sta_sv0, "$(sta_sv0=MAJOR)")
  macro(sta_sv1, "$(sta_sv1=NO_ALARM)")
  macro(sta_sv2, "$(sta_sv2=NO_ALARM)")
  macro(sta_sv3, "$(sta_sv3=NO_ALARM)")
  macro(sta_sv4, "$(sta_sv4=NO_ALARM)")
  macro(sta_sv5, "$(sta_sv5=NO_ALARM)")
  macro(sta_sv6, "$(sta_sv6=NO_ALARM)")
  macro(donecalc,   "((A=D)&(((A*2+1)=B)|A=2|C=0))?0:1")
}

expand("dlsPLC_valveIlk.vdb", valveIlk) {
  macro(DIR, "$(EMPTY=)")
  macro(ILK, "6")
  macro(INIILK, "7")
  macro(RAWILK, "8")
  macro(typeprefix, ":")
  macro(ilk0, "$(ilk0=unused)")
  macro(ilk1, "$(ilk1=unused)")
  macro(ilk2, "$(ilk2=unused)")
  macro(ilk3, "$(ilk3=unused)")
  macro(ilk4, "$(ilk4=unused)")
  macro(ilk5, "$(ilk5=unused)")
  macro(ilk6, "$(ilk6=unused)")
  macro(ilk7, "$(ilk7=unused)")
  macro(ilk8, "$(ilk8=unused)")
  macro(ilk9, "$(ilk9=unused)")
  macro(ilk10, "$(ilk10=unused)")
  macro(ilk11, "$(ilk11=unused)")
  macro(ilk12, "$(ilk12=unused)")
  macro(ilk13, "$(ilk13=unused)")
  macro(ilk14, "$(ilk14=unused)")
  macro(ilk15, "$(ilk15=unused)")
}

expand("dlsPLC_valveGilk.vdb", valveGilk) {
}

# Operational/Service Mode
#% archiver 10 Monitor
#% controldesk Mode smon
#
record(bi, "$(device):MODE") {
  field(DESC, "Mode")
  field(INP, "$(device):MODSTA.B0 CP MS")
  field(ZNAM, "$(mode1=Operational)")
  field(ONAM, "$(mode2=Service)")
}

record(stringin, "$(device):PAIREDIMG")
    {
    field(PINI, "YES")
    field(DESC,"$(img)")
    field(VAL,"$(img)")
    }

record(ai, "$(device):CURRENTP") 
    {
    field(DTYP, "Soft Channel")
    field(INP, "$(img):P CP MS")
    }

# NB: the OUT field is generated by :TARGETPOUT (below)
# at run time.
record(ao, "$(device):SETTARGETP") 
    {
    field(DTYP, "asynFloat64")
    field(OUT, "@asyn($(port), $(addr_decade)4, $(timeout=0)) FINS_DM_WRITE_32")
    field(DOL , "$(device):TARGETP")
    field(HOPR, "$(setpoint_max=5.0e-7)")
    field(DRVH, "$(setpoint_max=5.0e-7)")
    field(PREC, "$(prec=1)")
    field(FLNK, "$(device):GETTARGETP")
    }


# ############################################################################
# Target Pressure
# 
# % archiver 10 Monitor
# % controldesk Target Pressure readback
record(ai, "$(device):TARGETP") 
  {
  field(DESC, "Target Pressure")
  field(DTYP, "Soft Channel")
  field(PREC, "$(prec=1)")
  field(INP,  "$(device):GETTARGETP.VAL MS")
  }

record(subArray, "$(device):GETTARGETP") 
  {
  field(DESC, "Get Target Pressure")
  field(DTYP, "Soft Channel")
  field(FLNK, "$(device):TARGETP")
  field(FTVL, "DOUBLE")
  field(MALM, "100")
  }

# Target Pressure is in DM$(addr)+4. Calc the index into the 
# century record
record(calcout, "$(device):TARGETPINDX") 
  {
  field(CALC, "$(addr_decade)%10+4")
  field(OUT, "$(device):GETTARGETP.INDX PP")
  field(PINI, "YES")
  }

# TARGETP is in DM$(addr)+4. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "$(device):TARGETPINP")
  {
  field(CALC, "PRINTF(AA,FLOOR($(addr)/100))")
  field(AA, "$(vlvcc):DM%dXX CP MS")
  field(OUT, "$(device):GETTARGETP.INP CA")
  field(FLNK, "$(device):TARGETPINPDIS")
  field(SCAN, "1 second")
  }

# Disable the scalcout record so we don't keep writing values
record(ao, "$(device):TARGETPINPDIS") 
  {
  field(VAL, "1")
  field(OUT, "$(device):TARGETPINP.DISA")
  }








#! Further lines contain data used by VisualDCT
#! View(0,0,1.0)
#! Record("$(device):HASDEBOUNCE",500,436,0,0,"$(device):HASDEBOUNCE")

#! TemplateInstance("valveCtrl",820,220,0,"")
#! TemplateField("valveCtrl","sta_label0",16777215,0,1)
#! TemplateField("valveCtrl","con_label6",16777215,0,1)
#! TemplateField("valveCtrl","con_label5",16777215,0,1)
#! TemplateField("valveCtrl","con_label4",16777215,0,1)
#! TemplateField("valveCtrl","sta_label6",16777215,0,1)
#! TemplateField("valveCtrl","con_label3",16777215,0,1)
#! TemplateField("valveCtrl","con_label2",16777215,0,1)
#! TemplateField("valveCtrl","sta_label5",16777215,0,1)
#! TemplateField("valveCtrl","con_label1",16777215,0,1)
#! TemplateField("valveCtrl","sta_label4",16777215,0,1)
#! TemplateField("valveCtrl","con_label0",16777215,0,1)
#! TemplateField("valveCtrl","sta_label3",16777215,0,1)
#! TemplateField("valveCtrl","sta_label2",16777215,0,1)
#! TemplateField("valveCtrl","sta_label1",16777215,0,1)


#! TemplateInstance("valveIlk",1140,80,0,"")
#! TemplateField("valveIlk","INIILK",16777215,0,1)
#! TemplateField("valveIlk","ilk9",16777215,0,1)
#! TemplateField("valveIlk","ilk15",16777215,0,1)
#! TemplateField("valveIlk","ilk8",16777215,0,1)
#! TemplateField("valveIlk","ilk14",16777215,0,1)
#! TemplateField("valveIlk","ilk7",16777215,0,1)
#! TemplateField("valveIlk","RAWILK",16777215,0,1)
#! TemplateField("valveIlk","ilk13",16777215,0,1)
#! TemplateField("valveIlk","ilk6",16777215,0,1)
#! TemplateField("valveIlk","ILK",16777215,0,1)
#! TemplateField("valveIlk","ilk12",16777215,0,1)
#! TemplateField("valveIlk","ilk5",16777215,0,1)
#! TemplateField("valveIlk","ilk11",16777215,0,1)
#! TemplateField("valveIlk","ilk4",16777215,0,1)
#! TemplateField("valveIlk","DIR",16777215,0,1)
#! TemplateField("valveIlk","ilk10",16777215,0,1)
#! TemplateField("valveIlk","ilk3",16777215,0,1)
#! TemplateField("valveIlk","ilk2",16777215,0,1)
#! TemplateField("valveIlk","ilk1",16777215,0,1)
#! TemplateField("valveIlk","ilk0",16777215,0,1)


#! TemplateInstance("valveGilk",1460,400,0,"")

#! Record("$(device):MODE",1460,628,0,0,"$(device):MODE")
#! Field("$(device):MODE.INP",16777215,1,"$(device):MODE.INP")
